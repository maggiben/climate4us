{"ts":1357682219011,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"///////////////////////////////////////////////////////////////////////////////\n// @file         : application.js                                            //\n// @summary      : client side application                                   //\n// @version      : 0.14                                                      //\n// @project      : Node.JS + Express boilerplate for cloud9 and appFog       //\n// @description  :                                                           //\n// @author       : Benjamin Maggi                                            //\n// @email        : benjaminmaggi@gmail.com                                   //\n// @date         : 12 Dec 2012                                               //\n// @dependencies                                                             //\n//  jQuery       : 1.8.2                                                     //\n//  jQuery.UI    : 1.9.1                                                     //\n//  ICanHaz      : 0.10                                                      //\n//  Sammy        : 0.7.2                                                     //\n// ------------------------------------------------------------------------- //\n//                                                                           //\n// @copyright Copyright 2012 Benjamin Maggi, all rights reserved.            //\n//                                                                           //\n//                                                                           //\n// License:                                                                  //\n// This program is free software; you can redistribute it                    //\n// and/or modify it under the terms of the GNU General Public                //\n// License as published by the Free Software Foundation;                     //\n// either version 2 of the License, or (at your option) any                  //\n// later version.                                                            //\n//                                                                           //\n// This program is distributed in the hope that it will be useful,           //\n// but WITHOUT ANY WARRANTY; without even the implied warranty of            //\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             //\n// GNU General Public License for more details.                              //\n//                                                                           //\n///////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n// Main App closure                                                          //\n// @param {Function} window.jQuery || window.Zepto JS libraries              //\n///////////////////////////////////////////////////////////////////////////////\n;(function($) {\n    \"use strict\";\n    ///////////////////////////////////////////////////////////////////////////\n    // Station class                                                         //\n    // This object stores all information regarding the weather station      //\n    // It has no data bindings to UI                                         //\n    ///////////////////////////////////////////////////////////////////////////\n    var Station = function(arg) {\n        this.setup(arg);\n    };   \n    $.extend(Station.prototype, {\n        module: { \n            VERSION: \"0.11\",\n            license: {},\n            dependencies: {},\n            author: \"BM\",\n        },\n        properties: {\n            name: '',\n            id: 0,\n            _id: 0,\n            type: '',\n            country: '',\n            state: '',\n            city: '',\n            latitude: 0,\n            longitude: 0,\n            magic: 1234,\n            sensors: [],\n            created: null,\n            lastUpdate: new Date(),\n            lastAccess: new Date(),\n            isReady: false,\n            overview: true,\n            mine: true,\n            temperature: {\n                value: 0, \n                unit: 'C'\n            },\n            feelslike: {},\n            humidity: { \n                value: 0, \n                dewpoint: 0, \n                unit: 'RH' \n            },\n            wind: { \n                value: 0, \n                direction: 'SE', \n                degrees: 150, \n                unit: 'KMH' \n            },\n            rainfall: { \n                value: 0, \n                unit: 'MM' \n            },\n            pressure: { \n                value: 0, \n                unit: 'INHG', \n                type: 'relative' \n            }, \n            visibility: { \n                value: 0, \n                unit: 'KM' \n            },\n            astronomy: { \n                sunrise: \"08:01\", \n                sunset: \"16:42\" \n            },\n            forecast:[\n                {\n                    day: \"Today\",\n                    condition: \"\",\n                    high_temperature: 0.00,\n                    low_temperature: 0.00\n                },\n                {\n                    day: \"Tomorrow\",\n                    condition: \"\",\n                    high_temperature: 0.00,\n                    low_temperature: 0.00\n                }\n            ],\n        },\n        setup: function (options) {\n            var options = $.extend({}, this.properties, options);\n            var that = this;\n            that.id = options._id;\n            $.ajax({\n                url: \"/station/getbyid/\" + options._id,\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    that.properties = $.extend({}, that.properties, data);\n                    that.properties.id = that.properties._id;\n                    options.onLoad(that.properties);\n                },\n                \n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });\n        },\n        /*\n        setupx: function (a) {\n            var that = this;\n            that.id = a._id;\n            $.ajax({\n                url: \"/station/getbyid/\" + a._id,\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    //console.log(\"Station[\" + data._id + \"] successfully created\");\n                    that._id = data._id,\n                    that.id = data._id,\n                    that.name = data.name;\n                    that.type = data.type;\n                    that.temperature = data.temperature;\n                    that.humidity = data.humidity;\n                    that.latitude = data.latitude;\n                    that.longitude = data.longitude;\n                    //Preserve the original defaults by passing an empty object as the target\n                    //that = $.extend({}, that, data);\n                    a.onLoad(that);\n                },\n                \n                error: function (b) {\n                    var c = $.parseJSON(b.responseText);\n                    alert(c.errors);\n                },\n                complete: function () {                                \n                }\n            });\n        },\n        */\n        update: function (a) {\n            var that = this;\n            $.ajax({\n                url: \"/station/update/\" + that.id,\n                type: \"post\",\n                dataType: \"json\",\n                data: that,\n                success: function(data, textStatus, jqXHR) {\n                    console.log(\"data back: \" + JSON.stringify(data));\n                },\n                error: function (b) {\n                    var c = $.parseJSON(b.responseText);\n                    alert(c.errors);\n                },\n                complete: function () {                                \n                }\n            });\n        },        \n        // getters\n        getTemperature: function () { \n            return this.temperature; \n        },\n        getPressure: function () { \n            return this.pressure; \n        },\n        getHumidity: function () { \n            return this.humidity; \n        },\n        getWind:  function () { \n            return this.wind; \n        },\n        getWindDirection:  function () { \n            return this.wind.direction; \n        },\n        // setters\n        setTemperature: function (temperature) {\n            this.temperature = temperature; \n        },\n        setPressure: function (pressure) { \n            this.pressure = pressure; \n        },\n        setHumidity: function (humidity) { \n            this.humidity = humidity; \n        },\n        setWind:  function (wind) { \n            this.wind = wind; \n        },\n    });\n    ///////////////////////////////////////////////////////////////////////////\n    // Subscription class                                                    //\n    ///////////////////////////////////////////////////////////////////////////\n    var myApplication = function(options) {\n        this.init(options);\n    };\n    $.extend(myApplication.prototype, {\n        module: { \n            VERSION: \"0.10\",\n            license: {},\n            dependencies: {},\n            author: \"\",\n        },\n        settings: $.observable({\n            timeout: 500,\n            debug: true,\n            producction: false,\n            instances: 1\n        }),\n        properties: {\n            _id: null,\n            name: 'lab',\n            type: 'subscription',\n            magic: null,\n            created: null,\n            lastUpdate: null,\n            lastAccess: null,\n            isReady: false,\n            stations: [],\n            order: [],\n            selected: null,\n        },\n        onSetup: null,\n        init: function (options) {\n            var that = this;\n            //Preserve the original defaults by passing an empty object as the target\n            var options = $.extend({}, this.properties, options);\n            $.ajax({\n                url: \"/subscription/getbyid/\" + options._id,\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    that.properties = $.extend({}, that.properties, data);\n                    that.setup(that.properties);\n                    options.callback(that.properties);\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {\n                }\n            });\n        },\n        setup: function (properties) {\n            var that = this;\n            this.properties.order.forEach(function(_id) {\n                $.ajax({\n                    url: \"/station/getbyid/\" + _id,\n                    type: \"GET\",\n                    dataType: \"json\",\n                    success: function (data, textStatus, jqXHR) {\n                        that.properties.stations[data._id] = new Station({_id: data._id, type: data.type, onLoad: onLoad}); //that.stations[b[i]._id] =                   \n                        function onLoad(station) {\n                            station.isReady = true;\n                            //callback(station);\n                        }\n                    },\n                    error: function (jqXHR, status, error) {\n                        console.log(jqXHR.responseText);\n                    },\n                    complete: function () {\n                    }\n                });\n            });\n        },\n        getAllStations: function(options, callback)\n        {\n            var that = this;\n            this.properties.order.forEach(function(_id) {\n                $.ajax({\n                    url: \"/station/getbyid/\" + _id,\n                    type: \"GET\",\n                    dataType: \"json\",\n                    success: function (data, textStatus, jqXHR) {\n                        that.properties.stations[data._id] = new Station({_id: data._id, type: data.type, onLoad: onLoad}); //that.stations[b[i]._id] =                   \n                        function onLoad(station) {\n                            station.isReady = true;\n                            callback(station);\n                        }\n                    },\n                    error: function (jqXHR, status, error) {\n                        console.log(jqXHR.responseText);\n                    },\n                    complete: function () {\n                    }\n                });\n            });\n        },\n        setup2: function (a) {\n            var that = this;\n            //this.properties = $.observable(this.properties);\n            this.onSetup = a.onSetup;\n            this.properties.order.forEach(function(_id) {\n                console.log(\"loading station _id: \" + _id);\n                $.ajax({\n                    url: \"/station/getbyid/\" + _id,\n                    type: \"GET\",\n                    dataType: \"json\",\n                    success: function (data, textStatus, jqXHR) {\n                        console.log(\"/station/getbyid---: \" + JSON.stringify(data._id));\n                        that.properties.stations[data._id] = new Station({_id: data._id, type: data.type, onLoad: onLoad}); //that.stations[b[i]._id] = \n                        console.log(\"Attaching station id: \" + that.properties.stations[data._id].id);\n                        \n                        function onLoad(station) {\n                            station.isReady = true;\n                            console.log(\"is onLoad ready: \" + station.isReady + \" id: \" + station._id);\n                            a.onSetup(station);\n                        }\n                    },\n                    error: function (jqXHR, status, error) {\n                        console.log(jqXHR.responseText);\n                    },\n                    complete: function () {\n                    }\n                });\n            });\n        },\n        setupOLD: function (a) {\n            this.onSetup = a.onSetup;\n            var that = this;\n            $.ajax({\n                url: \"/station/getall\",\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (b) {\n                    for (var i = 0; i < b.length; i++) {\n                        that.properties.stations[b[i]._id] = new Station({_id: b[i]._id, type: b[i].type, onLoad: onLoad}); //that.stations[b[i]._id] = \n                        console.log(\"Attaching station id: \" + that.properties.stations[b[i]._id].id);\n                    }\n                    function onLoad(station) {\n                        station.isReady = true;\n                        console.log(\"is onLoad ready: \" + station.isReady + \" id: \" + station._id);\n                        a.onSetup(station);\n                    }\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });\n        },\n        listStations: function (a) {\n            for (var key in this.properties.stations)\n            {\n                if (this.properties.stations.hasOwnProperty(key))\n                {\n                    console.log(\"key: \" + key);\n                }\n            }\n            return !1;\n        },\n        getStationById: function(id) {\n            console.log(\"getStationById(%s)\", id);\n            console.log(\"getStationById(%s) = %s\", id, JSON.stringify(this.properties.stations[id]));\n            return this.properties.stations[id].properties;\n        },\n        getAllStationsIds: function() {\n            var stations = [];\n            for (var station in this.properties.stations)\n            {\n                if (this.properties.stations.hasOwnProperty(station))\n                {\n                    stations.push(station);\n                }\n            }\n            return stations;\n        },\n        getStations:  function (callback) {\n            var that = this;\n            $.ajax({\n                url: \"/getStations\",\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    callback(data);\n                },\n                error: function (jqXHR, status, error) {\n                    //var c = $.parseJSON(jqXHR);\n                    console.log(jqXHR.responseText);\n                }\n            });\n        },\n        getSelected: function() {\n          return this.properties.selected;\n        },\n        removeStations: function(ids, callback) {\n            for (var id in ids)\n            {\n                if (ids.hasOwnProperty(id))\n                {\n                    this.removeStation(id, function(station) {\n                    });\n                }\n            }\n        },\n        removeStation: function(id, callback) {\n            var that = this;\n            $.ajax({\n                url: \"/station/remove/\" + id,\n                type: \"delete\",\n                dataType: \"json\",\n                data: {},\n                success: function (data, textStatus, jqXHR) {\n                    delete that.properties.stations[data._id];\n                    console.log(\"removed id: \" + JSON.stringify(data));\n                    callback(data);\n                },\n                error: function (jqXHR, status, error) {\n                    var c = $.parseJSON(jqXHR);\n                    console.log(jqXHR.responseText);\n                }\n            }), !1;\n        },\n        addStation: function(station, callback) {\n            var that = this;\n            $.ajax({\n                url: \"/station/add\",\n                type: \"POST\",\n                dataType: \"json\",\n                data: station,\n                success: function (data, textStatus, jqXHR) {\n                    //new Station({_id: data._id, type: data.type, onLoad: onLoad});\n                    that.properties.stations[data._id] = new Station({_id: data._id, type: data.type, onLoad: onLoad});\n                    function onLoad(station) {\n                        station.isReady = true;\n                        callback(data);\n                    }\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                }\n            }), !1;\n        },\n        setSelected: function(id) {\n            var that = this;\n            that.update(onUpdate);\n            function onUpdate(data)\n            {\n                that.selected = id;\n                console.log(\"subscription update ok! result: \" + data);\n            };\n        },\n        update: function(callback) {\n            var that = this;\n            console.log(\"subscription update\");\n            $.ajax({\n                url: \"/subscription/update/\" + this._id,\n                dataType: \"json\",\n                type: \"put\",\n                data: that,\n                success: function (data, textStatus, jqXHR) {\n                    callback(data);\n                },\n                error: function (jqXHR, status, error) {\n                    var c = $.parseJSON(jqXHR);\n                    console.log(jqXHR.responseText);\n                },\n            });\n        },\n    });\n\n\n    ///////////////////////////////////////////////////////////////////////////\n    // Sammy.JS application                                                  //\n    ///////////////////////////////////////////////////////////////////////////\n    var app = $.sammy(function() {\n        //this.element_selector = '#main';\n        this.bind('getSubscription', function(e, data) {\n            //console.log(\"getSubscription\");\n            MyApp.subscription = new myApplication({onSetup: onSetup});\n            function onSetup(a) {\n                console.log(\"onSetup: \" + JSON.stringify(a));\n                $(\"#sites\").append(ich.site_template(a));\n                $(\"#s\" + a.id).html(ich.station_preview_template(a));\n                //MyApp.meldSidebar();\n            };\n        });\n        this.bind(\"station.setup\", function(e, data) {\n            console.log(\"station.setup: \" + JSON.stringify(data));\n            var site = $(\"#s\" + data.id);\n            if (site.hasClass(\"current\"))\n            {\n                return !0;\n            }\n            var station_template = ich.site_template(data);\n            $(station_template).appendTo('#sites').hide().fadeIn('slow');\n            //$(\"#sites\").append(ich.site_template(data));\n            $(\"#s\" + data.id).html(ich.station_preview_template(data));\n            //this.trigger(\"show_station.g\");\n            //this.trigger('showSite', {my_data: this.params});\n            $(\"div.site.current\").removeClass(\"current\");\n            site.addClass(\"current\");\n            $(\"#data\").html(ich.site_data_template(data)); \n            $(\"body\").addClass(\"view-nav\");\n        });\n        this.bind('showSite', function(e, data) {\n            var a = this;\n            var b = $(\"#s\" + data['my_data'].id);\n            if (b.hasClass(\"current\")) return !0;\n            $(\"div.site.current\").removeClass(\"current\");\n            b.addClass(\"current\");\n            $(\"#data\").html(ich.site_data_template({title: \"hello\", id: 1234, mine: false}));\n            //$(\"#data\").html(ich.site_data_template(this)), \n            //$(\"body\").addClass(\"view-nav\");\n            //alert(data['my_data'].id);\n        });\n        this.bind(\"show_station.g\", function(e, data) {\n            console.log(\"show_station.g: \" + JSON.stringify(data));\n            var station = $(\"#s\" + data.id);\n            if (station.hasClass(\"current\"))\n            {\n                return !0;\n            }\n            $(\"div.site.current\").removeClass(\"current\");\n            station.addClass(\"current\");\n            $(\"#data\").html(ich.site_data_template(MyApp.subscription.getStationById(data.id))); \n            $(\"body\").addClass(\"view-nav\");\n        });\n        this.bind(\"show_panel.g\", function (e, data) {\n            console.log(\"show_panel.g: \" + JSON.stringify(data));\n            var b = this;\n            var c = $(\"#s\" + data.id);\n            var d = data == c.data(\"panel\") ? $(\"#site_content div.display\").scrollTop() : 0;\n            b.trigger(\"show_station.g\", data), \n            c.data(\"panel\", data);\n            $(\"#data div.nav li.current\").removeClass(\"current\"); \n            $('#data div.nav a[href=\"#/station/' + data.id + \"/\" + data.path + '\"]').closest(\"li\").addClass(\"current\");\n            switch (data.path) {\n                case \"overview\":\n                    console.log(\"[overview]\");\n                    $(\"#site_content\").html(ich.overview_template(MyApp.subscription.getStationById(data.id)));\n                    var placeholder = $(\"#placeholder\");\n                    var d1 = [];\n                    for (var i = 0; i < Math.PI * 2; i += 0.25)\n                        d1.push([i, Math.sin(i)]);\n                    \n                    var d2 = [];\n                    for (var i = 0; i < Math.PI * 2; i += 0.25)\n                        d2.push([i, Math.cos(i)]);\n                \n                    var d3 = [];\n                    for (var i = 0; i < Math.PI * 2; i += 0.1)\n                        d3.push([i, Math.tan(i)]);\n                        \n                    var options = {\n                        series: {\n                            lines: { show: true },\n                            points: { show: true }\n                        },\n                        xaxis: {\n                            ticks: [0, [Math.PI/2, \"\\u03c0/2\"], [Math.PI, \"\\u03c0\"], [Math.PI * 3/2, \"3\\u03c0/2\"], [Math.PI * 2, \"2\\u03c0\"]]\n                        },\n                        yaxis: {\n                            ticks: 10,\n                            min: -2,\n                            max: 2\n                        },\n                        grid: {\n                            backgroundColor: { colors: [\"#fff\", \"#eee\"] }\n                        }\n                    }\n                    \n                    var data = [\n                        { label: \"sin(x)\",  data: d1},\n                        { label: \"cos(x)\",  data: d2},\n                        { label: \"tan(x)\",  data: d3}\n                    ];\n                    //$.plot($(\"#placeholder\"), [ [[0, 0], [1, 1], , [2, 3]] ], { yaxis: { max: 1 } });\n                    var plot = $.plot(placeholder, data, options);\n                    \n                    break;\n                case \"code\":\n                    console.log(\"[code]\");\n                    $(\"#site_content\").html(ich.my_info_template(this));\n                    break;\n                case \"live\":\n                    var e = this;\n                    $(\"#site_content\").html(ich.live_data_template(this))\n                    var options = {\n                        zoom: 8,\n                        center: new google.maps.LatLng(-34.6036, -58.3817),\n                        mapTypeId: google.maps.MapTypeId.ROADMAP\n                    };\n                    var map = new window.map({id: \"map_wrapper\", latitude: -34.6036, longitude: -58.3817, mapOptions: options});\n                    break;\n                case \"settings\":\n                    console.log(\"[settings]\");\n                    $(\"#site_content\").html(ich.station_settings_template(MyApp.subscription.getStationById(data.id)));\n                    break;\n                case \"sensors\":\n                    $(\"#site_content\").html(ich.station_sensors_template(MyApp.subscription.getStationById(data.id)));\n                    var temperature_gauge = new JustGage({\n                      id: \"temperature.gauge\", \n                      value: getRandomInt(0, 100), \n                      min: -30,\n                      max: 100,\n                      title: \"Temperature\",\n                      label: \"C°\"\n                    });\n                    var humidith_gauge = new JustGage({\n                      id: \"humidity.gauge\", \n                      value: getRandomInt(0, 100), \n                      min: 0,\n                      max: 100,\n                      levelColors: [\"#6996D3\", \"#0F4FA8\", \"#05316D\"], \n                      title: \"Humidity\",\n                      label: \"RH\"\n                    });\n                    setInterval(function() {\n                        temperature_gauge.refresh(getRandomInt(50, 100));\n                        humidith_gauge.refresh(getRandomInt(70, 100));\n                    }, 2500);\n                    break;\n                case \"terminal\":\n                    $(\"#site_content\").html(ich.station_terminal_template(MyApp.subscription.getStationById(data.id)));\n                    $(function($, undefined) {\n                        $('#terminal').terminal( function(command, term) {\n                            if (command !== '') {\n                                /*\n                                try {\n                                    var result = window.eval(command);\n                                    if (result !== undefined) {\n                                        term.echo(new String(result));\n                                    }\n                                } catch(e) {\n                                    term.error(new String(e));\n                                }\n                                */\n                                var shellstring = command.split(\" \");\n                                var cmd = shellstring.splice(0,1).toString();\n                                var args = [];\n                                shellstring.forEach(function(arg) {\n                                    args.push(arg);\n                                });\n                                MyApp.properties.socket.emit('consoleio', { message: 'exec', command: cmd, arguments: args})\n                                term.pause();\n                            } else {\n                                term.echo('');\n                            }\n                        }, {\n                        greetings: '[[b;#ccc;#750775]Node Terminal]',\n                        name: 'consoleio',\n                        height: 400,\n                        prompt: '# ',\n                        onInit: function(terminal) { console.log(\"console.init()\"); window.terminal = terminal || {} }\n                        });\n                    });\n                    break;\n                case \"srcedit\":\n                    $(\"#site_content\").html(ich.station_srceditor_template(MyApp.subscription.getStationById(data.id)));\n                    var editor = CodeMirror.fromTextArea(document.getElementById(\"code_editor\"), {\n                        lineNumbers: true,\n                        theme: 'monokai'\n                    });\n                    break;\n            }\n            $(\"body\").addClass(\"view-panel\");\n            $(\"#site_content div.display\").scrollTop(d);\n        });\n        this.bind(\"station_teardown.g\", function(event, data) {\n            console.log(\"station_teardown.g id: \" + JSON.stringify(data));\n            var a = $(\"#s\" + data.id);//.css({height: 0,opacity: 0});\n            setTimeout(function() {\n                a.hide('slow', function(){ $(this).remove();});\n                //a.hide('slow', function(){ $(this).remove();});\n                //a.remove()\n            }, 500);\n            //delete Gauges.sites[this.id]\n        });\n        this.get(/\\#\\/sites\\/(.*)/, function () {\n            //this.redirect(\"#\", \"gauges\", this.params.splat)\n            alert(this.params.splat);\n        });\n        this.get(\"#/\", function (a) {\n            $(\"body\").removeClass(\"no_cancel\").removeClass(\"my_account\");\n            $.trim($(\"#data\").html()) == \"\" && $(\"#sites div.site:first a\").length > 0 && a.redirect($(\"#sites div.site:first a\").attr(\"href\"))\n        });\n        ///////////////////////////////////////////////////////////////////////\n        // Account Routes                                                    //\n        ///////////////////////////////////////////////////////////////////////\n        this.get(\"#/account\", function() {\n            $(\"body\").removeClass(\"adding\"), \n            $.ajax({\n                url: \"/subscription\",\n                dataType: \"json\",\n                success: function(a) {\n                    //Gauges.subscription = new Subscription(a.subscription)\n                }\n            });\n            $(\"#sites div.current\").removeClass(\"current\"), \n            $(\"#data\").html(ich.account_template(MyApp.user)), \n            $('div.nav a[href=\"#/account\"]').closest(\"li\").addClass(\"current\"), \n            $(\"#site_content\").html(ich.my_info_template(MyApp.user))\n        });\n        this.get(\"#/account/clients\", function() {\n            $(\"body\").removeClass(\"adding\"), \n            $(\"#sites div.current\").removeClass(\"current\"), \n            $(\"#data\").html(ich.account_template(MyApp.user)), \n            $('div.nav a[href=\"#/account/clients\"]').closest(\"li\").addClass(\"current\"), \n            $(\"#site_content\").html(ich.clients_template(MyApp.user)), \n            $(\"#site_content\").find(\"input[title]\").labelize(), \n            MyApp.clients == null ? $.ajax({\n                url: \"/clients\",\n                dataType: \"json\",\n                type: \"get\",\n                success: function(data, textStatus, jqXHR) {\n                    MyApp.clients = data.clients, \n                    $(\"#clients_list\").removeClass(\"loading\").html(ich.clients_list_template(MyApp))\n                },\n                error: function(jqXHR, status, error) {\n                    $(\"#clients_list\").removeClass(\"loading\").addClass(\"empty\").text(\"Could not load API Keys\");\n                }\n            }) : $(\"#clients_list\").removeClass(\"loading\").html(ich.clients_list_template(MyApp));\n        });\n        this.post(\"#/account/clients\", function() {\n            console.log(\"targent: \" + this.target);\n            window.kaka = this.target;\n            var a = $(this.target).removeErrors(), \n            b = a.find(\"button span\");\n            clearTimeout(b.data(\"timeout\")), \n            b.data(\"text\") === undefined && b.data(\"text\", b.text()), \n            b.text(\"Creating...\"), \n            $.ajax({\n                url: \"/clients\",\n                dataType: \"json\",\n                type: \"post\",\n                data: {\n                    description: this.params.description\n                },\n                success: function(b) {\n                    MyApp.clients == null && (MyApp.clients = []), \n                    MyApp.clients.push(b.client), \n                    a.find(\"input[type=text]\").val(\"\").blur(), \n                    $(\"#clients_list\").removeClass(\"loading\").html(ich.clients_list_template(MyApp))\n                },\n                error: function (jqXHR, status, error) {\n                    //var c = $.parseJSON(jqXHR);\n                    console.log(jqXHR.responseText);\n                    //a.displayErrors(\"jqXHR.responseText\"), \n                    a.displayErrors({description: [\"Could not find that Email\"]});\n                    b.text(b.data(\"text\"))\n                },    \n                /*error: function(c) {\n                    \n                    var d = $.parseJSON(c.responseText);\n                    a.displayErrors(d.errors), b.text(b.data(\"text\"))\n                },*/\n                complete: function() {\n                    b.text(\"Created\"), \n                    setTimeout(function() {\n                        b.text(b.data(\"text\"))\n                    }, 2e3)\n                }\n            })\n        });\n        this.del(\"#/account/clients/:key\", function() {\n            var a = $(this.target).removeErrors(), \n            b = a.find(\"button span\");\n            clearTimeout(b.data(\"timeout\")), \n            b.data(\"text\") === undefined && b.data(\"text\", b.text()), b.text(\"Removing\"), \n            $.ajax({\n                url: \"/clients/\" + this.params.key,\n                dataType: \"json\",\n                type: \"delete\",\n                success: function(a) {\n                    MyApp.clients = $.compact($.map(MyApp.clients, function(b) {\n                        if (b.key != a.client.key)\n                            return b\n                    })), \n                    $(\"#clients_list\").html(ich.clients_list_template(MyApp))\n                }\n            })\n        });\n        ///////////////////////////////////////////////////////////////////////\n        // Session Routes                                                    //\n        ///////////////////////////////////////////////////////////////////////\n        this.get('#/sign_out', function() {\n            $.ajax({\n                    url: \"/signout\",\n                    type: \"GET\",\n                    complete: function () {\n                        window.location = \"/signin\";\n                    }\n            });\n            $(\"body\").addClass(\"loading\").removeClass(\"loaded\");\n        });\n        ///////////////////////////////////////////////////////////////////////\n        // Station Routes                                                    //\n        ///////////////////////////////////////////////////////////////////////\n        this.get('#/station/new', function() {\n            $(\"body\").addClass(\"adding\");\n        });\n        this.post('#/station', function () {\n            var that = this;\n            var a = $(this.target).removeErrors();\n            var b = a.find(\".submit button span\");\n            clearTimeout(b.data(\"timeout\"));\n            b.data(\"text\") === undefined && b.data(\"text\", b.text()); \n            b.text(\"Adding...\");\n            $.ajax({\n                url: \"/station/add\",\n                type: \"post\",\n                dataType: \"json\",\n                data: { \n                    name: that.params.name,\n                    type: that.params.type,\n                    country: that.params.country,\n                },\n                success: function (data, textStatus, jqXHR) {\n                    //console.log(\"server respose: \" + JSON.stringify(b));\n                    var c = data;\n                    // todo use getters instead of direct property access in this case the array \n                    MyApp.subscription.stations[data._id] = new Station({_id: data._id, type: data.type, onLoad: onLoad}); //\n                    function onLoad(station) {\n                        $(\"#new_title\").val(\"\");\n                        that.trigger('station.setup', station);\n                        setTimeout(function () {\n                            window.location.hash = \"/station/\" + station._id + \"/code\";\n                            $.scrollTo(\"#s\" + station._id, 800);\n                        }, 400); \n                        console.log(\"onLoad id: \" + station._id);\n                        //$.scrollTo(\"#s\" + station._id, 800);\n                        $(\"body\").removeClass(\"adding\");\n                        a.removeErrors();\n                        //that.trigger('station.setup', station);\n                    }\n                },\n                error: function (b) {\n                    //var c = $.parseJSON(b.responseText);\n                    a.displayErrors(c.errors);\n                },\n                complete: function () {\n                    b.text(b.data(\"text\"));\n                }\n            }), !1;\n        });\n        this.get(\"#/station/:id/:path\", function () {\n            //return;\n            //var a = MyApp.stations[this.params.id];\n            console.log(\"sammy route: #/station/%s/%s\", this.params.id, this.params.path);\n            //var a = MyApp.subscription.getStationById(this.params.id);\n            //console.log(\"MyApp.subscription.getStationById = \" + JSON.stringify(a));\n            //alert(typeof this.params.id);\n            //alert(MyApp.subscription.stations[this.params.id].name);\n            var station = MyApp.subscription.getStationById(this.params.id);//stations[this.params.id];\n            //MyApp.subscription.setSelected(this.params.id);\n            console.log(\"MyApp.subscription.stations[%s].name = %s\", this.params.id, station.name);\n            //alert(\"#/station/%s/%s\",typeof a, this.params.path);\n            //this.params.path == \"overview\" && a.setRecentTraffic();\n            //this.trigger('station.setup', station);\n            //this.trigger('station.setup', MyApp.subscription.stations[this.params.id]);\n            this.trigger(\"show_panel.g\", this.params); \n            MyApp.meldSidebar();\n        });\n        this.get('#/station/:id/code/:tab', function () {\n            alert(\"caca\");\n            console.log(\"new tab params: \" + JSON.stringify(this.params));\n            var station = MyApp.subscription.stations[this.params.id];\n            console.log(\"server respose: \" + JSON.stringify(b));\n            /*\n            var a = MyApp.sites[this.params.id];\n            */        \n            //a.trigger(\"show_panel.g\", [\"code\"]); \n            $(\"#site_content div.panel\").hide();\n            $(\"#site_content ul.group_options li\").removeClass(\"current\"); \n            $(\"#site_content div.panel.\" + this.params.tab).show();\n            $(\"#site_content ul.group_options li.\" + this.params.tab).addClass(\"current\"); \n            MyApp.meldSidebar();\n        });\n        this.get(\"#/deleting\", function() {\n        });\n        this.del(\"#/station/remove/:id\", function() {\n            var that = this;\n            var a = $(this.target).removeErrors(), b = a.find(\".submit button span\");\n            b.text(\"Deleting...\"), window.location.hash = \"/deleting\", \n            $.ajax({\n                url: \"/station/remove/\" + this.params.id,\n                dataType: \"json\",\n                type: \"delete\",\n                success: function(data, textStatus, jqXHR) {\n                    var station = data.station;\n                    console.log(\"remove server respose: \" + JSON.stringify(data));\n                    //var c = Gauges.sites[b.id];\n                    that.trigger(\"station_teardown.g\", that.params), \n                    $(\"#data\").html(ich.deleted_site_template(b)), \n                    window.location.hash = \"/\"\n                }\n        });\n    })\n        // Station routes\n    });\n    $(function() {\n        app.run();\n        //app.trigger('getSubscription', {time: new Date()});\n    });\n    \n    ///////////////////////////////////////////////////////////////////////////\n    // Main Client application                                               //\n    ///////////////////////////////////////////////////////////////////////////\n    var MyApp = {\n        module: { \n            VERSION: \"0.1.2.3\",\n            license: {},\n            dependencies: {},\n            author: \"\",\n        },\n        $: (typeof window !== 'undefined') ? window.jQuery || window.Zepto || null : null,\n        timeout: null,\n        clients: null,\n        connection_count: 0,\n        subscription: {},\n        subscriptions: [],\n        mousecoords: {\n            pageX: 0, \n            pageY: 0,\n        },\n        properties: {\n            delay: 10,\n            reconnect: true,\n            socket: null,\n            stdinp: null,\n            stdout: null,\n            stderr: null,\n        },\n        user: {\n                name: \"\", \n                id: \"\", \n                last_name: null, \n                first_name: null, \n                email: \"\",\n                subscriptions: [],\n                subscription: null,\n        },\n        init: function(options) {\n            var that = this;\n            console.log(\"MyApp.options\")\n            this.getUser({callback: gotUser})\n            \n            function gotUser(account)\n            {\n                //MyApp.subscription = new myApplication({_id: that.user.subscription, callback: onInit});\n                that.user.subscriptions.forEach(function(_id) {\n                    that.getSubscription({_id: _id, callback: gotSubscription});\n                });\n                \n                function gotSubscription(subscription) {\n                    console.log(\"subscription._id: \" + subscription._id);\n                    MyApp.subscriptions[subscription._id] = new myApplication({_id: subscription._id, callback: onInit});\n                }\n                \n                function onInit(subscription)\n                {\n                    //MyApp.subscriptions['50dfa3ce09556aa365000004'].properties.stations['50e9be722eda7b7a55000002']\n                    console.log(\"stations: \" + JSON.stringify(MyApp.subscriptions[subscription._id].properties.stations     ));\n                    \n                    /*\n                    subscription.order.forEach(function(_id) {\n                        console.log(\"station._id: \" + _id);\n                        console.log(\"names: \" + sub.selected);\n                        //$(\"#sites\").append(ich.site_template(a));\n                        //$(\"#s\" + a.id).html(ich.station_preview_template(a));\n                    });\n                    */\n                    MyApp.subscriptions[subscription._id].properties.stations.forEach(function(_id) {\n                        console.log(\"XXXXstation._id: \" + _id);\n                    });\n                }\n                /*\n                function onSetup(a) {\n                    console.log(\"onSetup: \" + JSON.stringify(a));\n                    $(\"#sites\").append(ich.site_template(a));\n                    $(\"#s\" + a.id).html(ich.station_preview_template(a));\n                    //MyApp.meldSidebar();\n                };\n                */\n            }\n            return;\n            var that = this;\n            MyApp.subscription = new myApplication({onSetup: onSetup});\n            function onSetup(a) {\n                $(\"#sites\").append(ich.site_template(a));\n                $(\"#s\" + a.id).html(ich.station_preview_template(a));\n            };\n        },\n        start: function(options) {\n            var that = this;\n            //a === 0 ? app.runRoute(\"get\", \"#/map\") : window.location.hash == \"#/\" && (window.location.hash = \"\");\n            //jQuery.get('http://laboratory.bmaggi.c9.io/cors.php', null, function(data){alert(data);});\n            // new myApplication({onSetup: onSetup});\n            \n            $.ajax({\n                url: '/application/start',\n                type: 'GET',\n                dataType: \"json\",\n                success: function(data, textStatus, jqXHR) {\n                    //that.subscription subscription: {},\n                },\n                error: function (jqXHR, status, error) {\n                    //c.removeClass(\"loading\")\n                },\n                complete: function () {\n                \n                },\n            });\n        },\n        getSubscription: function(options) {\n            var that = this;\n            console.log(\"MyApp.getSubscription(%s)\", options._id);\n            $.ajax({\n                url: \"/subscription/getbyid/\" + options._id,\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    console.log(data);\n                    //MyApp.user.subscription = new myApplication({_id: that.user.subscription, callback: onInit});\n                    if($.isFunction(options.callback))\n                    {\n                        options.callback(data);\n                    }\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {\n                }\n            });\n        },\n        setSubscription: function(_id) {\n            var that = this;\n            $.ajax({\n                url: \"/account/subscription\",\n                type: \"PUT\",\n                dataType: \"json\",\n                data: {subscription: _id},\n                success: function (data, textStatus, jqXHR) {\n                    that.user.subscription = data.subscription;\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });      \n        },\n        createSubscription: function(options) {\n            var that = this;\n            var options = $.extend({}, this.properties, options);\n            $.ajax({\n                url: \"/subscription/create\",\n                type: \"POST\",\n                dataType: \"json\",\n                data: options,\n                success: function (data, textStatus, jqXHR) {\n                    that.properties = $.extend({}, that.properties, data);\n                    that.properties.isReady = true;\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });    \n        },\n        reset: function () {},\n        setUser: function (a) {\n            //this.user = a.user, a.subscription && (this.subscription = new Subscription(a.subscription))\n        },\n        getUser: function(options) {\n            var that = this;\n            console.log(\"getUser\");\n            $.ajax({\n                url: \"/account/getAccount\",\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    that.user = $.extend({}, that.user, data);\n                    options.callback(that.user);\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n            });    \n        },\n        getSettings: function(a) {\n                /*\n                $(\"#sites div.current\").removeClass(\"current\"), \n                $(\"#data\").html(ich.account_template(Gauges.user)), \n                $('div.nav a[href=\"#/account\"]').closest(\"li\").addClass(\"current\"), \n                $(\"#site_content\").html(ich.my_info_template(Gauges.user))  \n                */\n        },\n        meldSidebar: function () {\n            var a = $(\"#sites div.current\"),\n                b = $(\"#data\");\n            $(window).scrollTop() == 0 ? $(\"#sites\").removeClass(\"topcut\") : $(\"#sites\").addClass(\"topcut\"), $(\"#sites\").height() > b.outerHeight() ? $(\"#sites\").addClass(\"bottomcut\") : $(\"#sites\").removeClass(\"bottomcut\");\n            if (a.length > 0) {\n                var c = a.offset().top,\n                    d = c + a.outerHeight(),\n                    e = b.offset().top,\n                    f = e + b.outerHeight(),\n                    g = a.attr(\"id\") == $(\"#sites > div:first\").attr(\"id\") ? 0 : 10;\n                a.length > 0 && c >= e + g && d < f - 10 ? $(\"#sites\").addClass(\"meld\") : $(\"#sites\").removeClass(\"meld\")\n                }\n        },\n        resize: function() {\n            console.log(\"resize\");\n            MyApp.meldSidebar();\n            \n            //$(\"#full_map\").is(\":visible\") && (Gauges.resize_timeout && clearTimeout(Gauges.resize_timeout), \n            //Gauges.resize_timeout = setTimeout(Gauges.showScreenMap, 300));\n        },\n        formatNumber: function (a) {\n            a += \"\";\n            var b = /(\\d+)(\\d{3})/;\n            while (b.test(a)) a = a.replace(b, \"$1,$2\");  // ',' thousand separator\n            return a\n        },\n        parseQueryString: function (a) {\n            if (a.indexOf(\"?\") == -1) return {\n                date: \"recent\"\n            };\n            var b = {};\n            return _.each(a.split(\"?\")[1].split(\"&\"), function (a) {\n                var c = a.split(\"=\");\n                b[c[0]] = c[1]\n            }), b\n        },\n        overview: function () {\n            return {\n                views: this.formatNumber(this.today.views),\n                people: this.formatNumber(this.today.people)\n            }\n        },\n        domready: function() {\n            console.log(\"DOMContentLoaded starting MyApp.version: %f\", this.module.VERSION);\n            this.init({user: 'uid'});\n            $(\"body\").height(0);\n            $(\"#data\").html(ich.greetings_template(this));\n        }\n    };\n    MyApp = MyApp || {};\n\n    ///////////////////////////////////////////////////////////////////////////\n    // Use CommonJS if applicable                                            //\n    ///////////////////////////////////////////////////////////////////////////\n    console.log(\"using commons\")\n    if (typeof require !== 'undefined') {\n        //module.exports = myApplication;\n    } else {\n        // else attach it to the window\n        console.log(\"attachinng plugin\")\n        window.MyApp = MyApp;\n    }\n    if (typeof document !== 'undefined') {\n        if (MyApp.$) {\n            MyApp.$(function () {\n                MyApp.domready();\n            });\n        } else {\n            document.addEventListener('DOMContentLoaded', function () {\n                MyApp.domready();\n            }, true);\n        }\n    }\n})(window.jQuery || window.Zepto);\n\n///////////////////////////////////////////////////////////////////////////////\n// jQuery on document ready closure                                          //\n// Activates UI components                                                   //\n// Sets and gets default data bindings                                       //\n///////////////////////////////////////////////////////////////////////////////\n$(document).ready(function() {\n    \"use strict\";\n    \n        ///////////////////////////////////////////////////////////////////////////\n    // UI Events & UI transformations                                        //\n    ///////////////////////////////////////////////////////////////////////////\n    $(\"#new_site a.cancel\").live(\"click\", function () {\n        return window.location.hash = \"#/\", $(\"body\").removeClass(\"adding\"), !1;\n    });\n    $(\"a.toggle_delete\").live(\"click\", function () {\n        return $(\"#site_content\").toggleClass(\"delete\"), !1;\n    });\n\n    ///////////////////////////////////////////////////////////////////////////\n    // Custom jQuery Functions                                               //\n    ///////////////////////////////////////////////////////////////////////////\n    $.fn.displayErrors = function(a, b) {\n        var c = this.removeErrors();\n        c.parent().addClass(\"error\");\n        for (var key in a) {\n            var d = b ? b + \"[\" + key + \"]\" : key;\n            var e = a[key].join(\", \");\n            console.log(\"a[%s] = %s\", key, e);            \n            var f = '<strong class=\"error_explanation\">' + e + \"</strong>\";\n            c.find('[name=\"' + d + '\"]').addClass(\"error\").closest(\"p\").append(f);\n        }\n        var g = c.closest(\"section\");\n        return g.length > 0 && g.trigger(\"resize.g\", [c.closest(\".panel\").height()]), this;\n    };\n    $.fn.removeErrors = function() {\n        this.parent().removeClass(\"error\").find(\"input.error\").removeClass(\"error\"), this.find(\"strong.error_explanation\").remove();\n        var a = this.closest(\"section\");\n        return a.length > 0 && a.trigger(\"resize.g\", [this.closest(\".panel\").height()]), this;\n    };\n    $.fn.labelize = function() {\n        return this.focus(function() {\n            $(this).val() == $(this).attr(\"title\") && ($(this).removeClass(\"labelized\"), $(this).val(\"\"))\n        }).blur(function() {\n            $.trim($(this).val()) == \"\" && ($(this).addClass(\"labelized\"), $(this).val($(this).attr(\"title\")))\n        }).blur().each(function() {\n            var b = $(this);\n            $(this.form).submit(function($) {\n                b.focus()\n            })\n        })\n    };\n    \n    $(\"#sites\").sortable({\n        axis: \"y\",\n        container: \"#sites\",\n        opacity: 0.5,\n        delay: 200,\n        items: \"div.site\",\n        start: function () {\n            $(\"#sites\").removeClass(\"meld\");\n        },\n        stop: function () {\n            $.ajax({\n                url: \"/subscription/reorder/\" + MyApp.user.subscription,\n                dataType: \"json\",\n                type: \"put\",\n                data: {\n                    _id: MyApp.user.subscription,\n                    ids: $.map($(this).sortable(\"toArray\"), function (a) {\n                        console.log(\"reorder: %s\", a.replace(/^s/, \"\"));\n                        return a.replace(/^s/, \"\");\n                    })\n                }\n            }),\n            MyApp.meldSidebar();\n        }\n    });\n    $('#new_date').datepicker({\n        //comment the beforeShow handler if you want to see the ugly overlay\n        beforeShow: function() {\n            setTimeout(function(){\n                $('.ui-datepicker').css('z-index', 9999); // Fix For top(Z) dialogs\n            }, 0);\n        }\n    }).val($.datepicker.formatDate('dd/m/yy', new Date()));\n    $(\"li.live .status\").text(\"off\");\n    $(\"html\").removeClass(\"live\");\n    \n    $(window).scroll(function() {\n        var a = $(window).height()\n        , docHeight = $(document).height()\n        , winScrollTop = $(window).scrollTop()\n        , wrapper = $(\"#wrapper\")\n        , body = $(\"body\");\n        \n        if (wrapper.data(\"scrollTop\") < winScrollTop) {\n            $(document.body).height(docHeight - body.css(\"padding-top\").replace(\"px\", \"\"));\n        }\n        else {\n            var f = body.height() - (wrapper.data(\"scrollTop\") - winScrollTop);\n            f >= wrapper.height() ? body.height(f) : body.height(wrapper.height());\n        }\n        wrapper.data(\"scrollTop\", winScrollTop);\n    });\n    $(window).scroll(MyApp.meldSidebar).resize(MyApp.resize);\n    $(function() {\n        //$(\"#new_site .tz\").append(TZ.select(\"new_tz\")), \n        //$(\"body\").hasClass(\"loading\") ? MyApp.start() : auth.run(), \n        document.onmousemove = function(a) {\n            window.MyApp.mousecoords.pageX = window.event ? window.event.clientX : a.pageX;\n            window.MyApp.mousecoords.pageY = window.event ? window.event.clientY : a.pageY;\n        }\n    });\n});\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Google MAPS bindings                                                      //\n///////////////////////////////////////////////////////////////////////////////\n;(function($) {\n    \"use strict\";\n    window.map = function (method) {\n        if (methods[method]) {\n            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));\n        } else if (typeof method === 'object' || !method) {\n            return methods.init.apply(this, arguments);\n        } else {\n            $.error('Method ' + method + ' does not exists.');\n        }\n    };\n    var methods = {};\n    //Set defauls for the control\n    var defaults = {\n        data: [],\n        icon: 'images/markers/anniversary.png',\n        title: 'Feria',\n        width: 260,\n        height: null,\n        background: \"#eee\",\n        mapOptions: {\n            zoom: 8,\n            center: new google.maps.LatLng(0, 0),\n            mapTypeId: google.maps.MapTypeId.ROADMAP\n        }\n    };\n    //Public methods \n    methods.init = function (options) {\n        //Preserve the original defaults by passing an empty object as the target\n        var options = $.extend({}, defaults, options);\n        console.log(JSON.stringify(options));\n        \n        var myLatlng = new google.maps.LatLng(options.latitude, options.longitude)\n        var image = 'images/markers/anniversary.png'  \n        \n        var map = new google.maps.Map(document.getElementById(options.id), options.mapOptions);\n\n        var marker = new google.maps.Marker({\n            position: myLatlng,\n            map: map,\n            title: 'Galaconcert',\n            icon: image\n        });\n        google.maps.event.addListener(marker, 'click', function() {\n            //infoBox.setContent(div);\n            //infoBox.open(map, marker);\n        });\n\n    };\n    //Public:\n    methods.moveMarker = function (placeName, latlng){\n        //marker.setPosition(latlng);\n        //infowindow.close();\n    };\n    //Private:\n    function makeBubble(map, index) {\n        return new InfoBubble({\n            map: map,\n            content: '<div class=\"signin\"><form action=\"/signin\" method=\"post\"><p class=\"phoneytext\">Hello There</p></form></div>',\n            position: new google.maps.LatLng(-34.6036, -58.3817),\n            shadowStyle: 1,\n            padding: 0,\n            backgroundColor: 'rgb(57,57,57)',\n            borderRadius: 4,\n            arrowSize: 10,\n            borderWidth: 1,\n            borderColor: '#2c2c2c',\n            disableAutoPan: true,\n            hideCloseButton: true,\n            arrowPosition: 30,\n            backgroundClassName: 'signin',\n            arrowStyle: 2\n        });  \n    };\n})(window.jQuery || window.Zepto);\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Google MAPS bindings                                                      //\n///////////////////////////////////////////////////////////////////////////////\n$(document).ready(function() {\n    \"use strict\";\n    \n    $(function initialize() {\n        var myLatlng = new google.maps.LatLng(0, 0) //(-34.6036, -58.3817);\n        var image = 'images/markers/anniversary.png'\n        var myOptions = {\n          zoom: 1,\n          center: myLatlng,\n          mapTypeId: google.maps.MapTypeId.ROADMAP\n        }        \n        var map = new google.maps.Map(document.getElementById(\"map_canvas\"), myOptions);\n        \n        var contentString = \n            '<div id=\"infowindow\">' +\n            'Galaconcert<br />' +\n            'Jaarbeurslaan 2-6<br />' +\n            '3690 Genk' +\n            '</div>'\n        ;\n        var infowindow = new google.maps.InfoWindow();\n        \n        \n        var marker = new google.maps.Marker({\n            position: myLatlng,\n            map: map,\n            title: 'Galaconcert',\n            icon: image\n        });\n        var infowindow = new google.maps.InfoWindow(); \n        \n        var input = document.getElementById('new_location');         \n        var autocomplete = new google.maps.places.Autocomplete(input, {\n            types: [\"geocode\"]\n        });\n        autocomplete.bindTo('bounds', map); \n        \n     \n        google.maps.event.addListener(autocomplete, 'place_changed', function() {\n            infowindow.close();\n            var place = autocomplete.getPlace();\n            if (place.geometry.viewport) {\n                map.fitBounds(place.geometry.viewport);\n            } else {\n                map.setCenter(place.geometry.location);\n                map.setZoom(17);  \n            }\n            moveMarker(place.name, place.geometry.location);\n        });  \n        \n        $(input).focusin(function () {\n            $(document).keypress(function (e) {\n                if (e.which == 13) {\n                     selectFirstResult();   \n                }\n            });\n        });\n        $(input).focusout(function () {\n            if(!$(\".pac-container\").is(\":focus\") && !$(\".pac-container\").is(\":visible\"))\n                selectFirstResult();\n        });\n        function selectFirstResult() {\n            infowindow.close();\n            $(\".pac-container\").hide();\n            var firstResult = $(\".pac-container .pac-item:first\").text();\n            console.log(\"selectFirstResult: \" + firstResult)\n            \n            var geocoder = new google.maps.Geocoder();\n            geocoder.geocode({\"address\":firstResult }, function(results, status) {\n                if (status == google.maps.GeocoderStatus.OK) {\n                    var lat = results[0].geometry.location.lat(),\n                        lng = results[0].geometry.location.lng(),\n                        placeName = results[0].address_components[0].long_name,\n                        latlng = new google.maps.LatLng(lat, lng);\n                    \n                    moveMarker(placeName, latlng);\n                    $(input).val(firstResult);\n                }\n            });   \n        }\n        var div = document.createElement('DIV');\n        $(div).html(ich.infobubble_template({name: $(input).val()}));\n        google.maps.event.addListener(marker, 'click', function() {\n            //infowindow.setContent(contentString);\n            //infowindow.open(map, marker);\n            infoBubble2.setContent(div);\n            infoBubble2.open(map, marker);\n        });\n        \n        function moveMarker(placeName, latlng){\n            marker.setIcon(image);\n            marker.setPosition(latlng);\n            infowindow.close();\n            //infowindow.setContent(contentString);\n            infoBubble2.setContent(div);\n            //infowindow.open(map, marker);\n            //infoBubble2.open(map, marker);\n        }\n        \n        var infoBubble2 = new InfoBubble({\n          map: map,\n          content: '<div class=\"signin\"><form action=\"/signin\" method=\"post\"><p class=\"phoneytext\">Hello There</p></form></div>',\n          position: new google.maps.LatLng(-34.6036, -58.3817),\n          shadowStyle: 1,\n          padding: 0,\n          backgroundColor: 'rgb(57,57,57)',\n          borderRadius: 4,\n          arrowSize: 10,\n          borderWidth: 1,\n          borderColor: '#2c2c2c',\n          disableAutoPan: true,\n          hideCloseButton: true,\n          arrowPosition: 30,\n          backgroundClassName: 'signin',\n          arrowStyle: 2\n        });\n    });\n});"]],"start1":0,"start2":0,"length1":0,"length2":63508}]],"length":63508}
{"contributors":[],"silentsave":true,"ts":1357746080649,"patch":[[{"diffs":[[0,"   : 0.1"],[-1,"4"],[1,"5"],[0,"        "]],"start1":254,"start2":254,"length1":17,"length2":17},{"diffs":[[0,"//////\n\n"],[1,"///////////////////////////////////////////////////////////////////////////////\n// Custom jQuery Functions (go first)                                        //\n///////////////////////////////////////////////////////////////////////////////\n$(document).ready(function() {\n    \"use strict\";\n    \n    $.fn.displayErrors = function(a, b) {\n        var c = this.removeErrors();\n        c.parent().addClass(\"error\");\n        for (var key in a) {\n            var d = b ? b + \"[\" + key + \"]\" : key;\n            var e = a[key].join(\", \");\n            console.log(\"a[%s] = %s\", key, e);            \n            var f = '<strong class=\"error_explanation\">' + e + \"</strong>\";\n            c.find('[name=\"' + d + '\"]').addClass(\"error\").closest(\"p\").append(f);\n        }\n        var g = c.closest(\"section\");\n        return g.length > 0 && g.trigger(\"resize.g\", [c.closest(\".panel\").height()]), this;\n    };\n    $.fn.removeErrors = function() {\n        this.parent().removeClass(\"error\").find(\"input.error\").removeClass(\"error\"), this.find(\"strong.error_explanation\").remove();\n        var a = this.closest(\"section\");\n        return a.length > 0 && a.trigger(\"resize.g\", [this.closest(\".panel\").height()]), this;\n    };\n    $.fn.labelize = function() {\n        return this.focus(function() {\n            $(this).val() == $(this).attr(\"title\") && ($(this).removeClass(\"labelized\"), $(this).val(\"\"))\n        }).blur(function() {\n            $.trim($(this).val()) == \"\" && ($(this).addClass(\"labelized\"), $(this).val($(this).attr(\"title\")))\n        }).blur().each(function() {\n            var b = $(this);\n            $(this.form).submit(function($) {\n                b.focus()\n            })\n        })\n    };\n});\n"],[0,"////////"]],"start1":2553,"start2":2553,"length1":16,"length2":1716},{"diffs":[[0,"perties, data);\n"],[1,"                    if(that.properties.order.length > 0)\n                    {\n    "],[0,"                "]],"start1":12063,"start2":12063,"length1":32,"length2":115},{"diffs":[[0,"(that.properties"],[1,", options.callback"],[0,");\n"],[1,"                    }\n                    else\n                    {\n    "],[0,"                "]],"start1":12192,"start2":12192,"length1":35,"length2":126},{"diffs":[[0,"at.properties);\n"],[1,"                    }\n"],[0,"                "]],"start1":12341,"start2":12341,"length1":32,"length2":54},{"diffs":[[0,"operties"],[1,", callback"],[0,") {\n    "]],"start1":12639,"start2":12639,"length1":16,"length2":26},{"diffs":[[0,"    "],[-1,"this.properties.order.forEach("],[1,"// Create a new queue.\n            var queue = $.jqmq({\n                 // Next item will be processed only when queue.next() is called in callback.\n                delay: -1,\n                // Process queue items one-at-a-time.\n                batch: 1,\n                // For each queue item, execute this function, making an AJAX request. Only\n                // continue processing the queue once the AJAX request's callback executes.\n                callback: "],[0,"func"]],"start1":12698,"start2":12698,"length1":38,"length2":475},{"diffs":[[0,"lback: function("],[1," "],[0,"_id"],[1," "],[0,") {\n"],[1,"                    console.log(\"get: /station/getbyid/\" + _id);\n    "],[0,"                "]],"start1":13162,"start2":13162,"length1":39,"length2":110},{"diffs":[[0,"       $.ajax({\n"],[1,"    "],[0,"                "]],"start1":13265,"start2":13265,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"type: \"GET\",\n   "]],"start1":13341,"start2":13341,"length1":32,"length2":36},{"diffs":[[0,"   type: \"GET\",\n"],[1,"    "],[0,"                "]],"start1":13358,"start2":13358,"length1":32,"length2":36},{"diffs":[[0,"taType: \"json\",\n"],[1,"    "],[0,"                "]],"start1":13400,"start2":13400,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"that.properties."]],"start1":13494,"start2":13494,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"function onLoad("]],"start1":13669,"start2":13669,"length1":32,"length2":36},{"diffs":[[0,"Load(station) {\n"],[1,"                                console.log(\"data is back \" + JSON.stringify(station.name));\n    "],[0,"                "]],"start1":13700,"start2":13700,"length1":32,"length2":129},{"diffs":[[0,"    "],[-1,"//callback(station"],[1,"    queue.next(false"],[0,");\n "]],"start1":13889,"start2":13889,"length1":26,"length2":28},{"diffs":[[0,"                "],[-1,"}\n"],[1,"    }\n    "],[0,"                "]],"start1":13924,"start2":13924,"length1":34,"length2":42},{"diffs":[[0,"             },\n"],[1,"    "],[0,"                "]],"start1":13957,"start2":13957,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"console.log(jqXH"]],"start1":14046,"start2":14046,"length1":32,"length2":36},{"diffs":[[0,"    "],[-1,"},\n                    complete: function "],[1,"        // If the request was unsuccessful, make another attempt.\n                            queue.next(true);\n                        },\n                    });\n                },\n                // When the queue completes naturally, execute this function.\n                complete: function"],[0,"()"],[-1," "],[0,"{\n  "]],"start1":14115,"start2":14115,"length1":53,"length2":304},{"diffs":[[0,"    "],[-1,"}\n                });\n           "],[1,"callback(that.properties);\n                }\n            });\n            that.properties.order.forEach(function(_id) { queue.add(_id)"],[0," });"]],"start1":14433,"start2":14433,"length1":41,"length2":141},{"diffs":[[0,"ted;\n        },\n"],[1,"        getOrder: function() {\n            return this.properties.order;\n        },\n        setOrder: function(order) {\n            var that = this;\n            $.ajax({\n                url: \"/subscription/reorder/\" + that.properties._id,\n                dataType: \"json\",\n                type: \"put\",\n                data: {\n                    _id: that.properties._id,\n                    ids: order,\n                },\n                success: function (data, textStatus, jqXHR) {\n                    console.log(data)\n                    that.properties.order = order;\n                }\n            })\n        },\n"],[0,"        removeSt"]],"start1":19620,"start2":19620,"length1":32,"length2":650},{"diffs":[[0,") {\n"],[-1,"                    //new Station({_id: data._id, type: data.type, onLoad: onLoad});\n"],[0,"    "]],"start1":21527,"start2":21527,"length1":93,"length2":8},{"diffs":[[0,"isReady = true;\n"],[1,"                        that.properties.order.push(station._id);\n                        var order = that.getOrder();\n                        that.setOrder(order);\n"],[0,"                "]],"start1":21730,"start2":21730,"length1":32,"length2":196},{"diffs":[[0,"       callback("],[-1,"data"],[1,"station"],[0,");\n             "]],"start1":21927,"start2":21927,"length1":36,"length2":39},{"diffs":[[0,"   });\n\n"],[-1,""],[1,"    window.Subscription = myApplication;"],[0,"\n    ///"]],"start1":23042,"start2":23042,"length1":16,"length2":56},{"diffs":[[0,"var "],[-1,"d1 = [];\n                    for (var i = 0; i < Math.PI * 2; i += 0.25)\n                        d1.push([i, Math.sin(i)]);\n                    \n                    var d2 = [];\n                    for (var i = 0; i < Math.PI * 2; i += 0.25)\n                        d2.push([i, Math.cos(i)]);\n                \n                    var d3 = [];\n                    for (var i = 0; i < Math.PI * 2; i += 0.1)\n                        d3.push([i, Math.tan(i)]);\n                        \n                    var options = {\n                        series: {\n    "],[1,"options = {\n"],[0,"    "]],"start1":26620,"start2":26620,"length1":564,"length2":20},{"diffs":[[0,"        "],[-1,"    "],[0,"points: "]],"start1":26699,"start2":26699,"length1":20,"length2":16},{"diffs":[[0,"ue }"],[-1,"\n                        }"],[0,",\n  "]],"start1":26725,"start2":26725,"length1":34,"length2":8},{"diffs":[[0,"s: {"],[-1,"\n                            ticks: [0, [Math.PI/2, \"\\u03c0/2\"], [Math.PI, \"\\u03c0\"], [Math.PI * 3/2, \"3\\u03c0/2\"], [Math.PI * 2, \"2\\u03c0\"]]\n                        },\n                        yaxis: {\n                            ticks: 10,\n                            min: -2,\n                            max: 2\n                        },\n                        grid: {\n                            backgroundColor: { colors: [\"#fff\", \"#eee\"] }\n                        }\n                    }\n                    \n                    var data = [\n                        { label: \"sin(x)\",  data: d1},\n                        { label: \"cos(x)\",  data: d2},\n                        { label: \"tan(x)\",  data: d3}\n                    ];\n                    //$.plot($(\"#placeholder\"), [ [[0, "],[1," tickDecimals: 0, tickSize: 1 }\n                    };\n                    var data = [];\n                    var placeholder = $(\"#placeholder\");\n                    \n                    $.plot(placeholder, data, options);\n\n                    data = [[1999, 3.0], [2000, 3.9], [2001, 2."],[0,"0], ["],[-1,"1"],[1,"2002"],[0,", 1"],[1,".2"],[0,"], "],[-1,", [2, 3]] ], { yaxis: { max: 1 } });\n "],[1,"[2003, 1.3], [2004, 2.5], [2005, 2.0], [2006, 3.1], [2007, 2.9], [2008, 0.9]];\n"],[0,"    "]],"start1":26759,"start2":26759,"length1":848,"length2":392},{"diffs":[[0,"    "],[-1,"var plot ="],[0," $.p"]],"start1":27162,"start2":27162,"length1":18,"length2":8},{"diffs":[[0,"tions);\n"],[-1,"                    \n"],[0,"        "]],"start1":27195,"start2":27195,"length1":37,"length2":16},{"diffs":[[0,"});\n"],[-1,"        ///////////////////////////////////////////////////////////////////////\n        // Station Routes                                                    //\n        ///////////////////////////////////////////////////////////////////////\n        this.get('#/station/new', function() {\n            $(\"body\").addClass(\"adding\");\n        });\n        this.post('#/station"],[1,"\n        ///////////////////////////////////////////////////////////////////////\n        // Station Routes                                                    //\n        ///////////////////////////////////////////////////////////////////////\n        this.post('#/subscription/new', function () {\n            var that = this;\n            var a = $(this.target).removeErrors();\n            var b = a.find(\".submit button span\");\n            clearTimeout(b.data(\"timeout\"));\n            b.data(\"text\") === undefined && b.data(\"text\", b.text()); \n            b.text(\"Adding...\");\n            MyApp.createSubscription({\n                name: that.params.name,\n                type: 'lab',\n                stations: [],\n                order: [],\n                selected: null,\n            }, function(a) {\n                console.log(a);\n            });\n        });\n        ///////////////////////////////////////////////////////////////////////\n        // Station Routes                                                    //\n        ///////////////////////////////////////////////////////////////////////\n        this.get('#/station/new', function() {\n            $(\"body\").addClass(\"adding\");\n        });\n        this.post('#/station', function () {\n            var that = this;\n            var a = $(this.target).removeErrors();\n            var b = a.find(\".submit button span\");\n            clearTimeout(b.data(\"timeout\"));\n            b.data(\"text\") === undefined && b.data(\"text\", b.text()); \n            b.text(\"Adding...\");\n            MyApp.subscription.addStation({\n                name: that.params.name,\n                type: that.params.type,\n                country: that.params.country\n            }, function(station) {\n                console.log(station)\n                $(\"#new_title\").val(\"\");\n                that.trigger('station.setup', station);\n                setTimeout(function () {\n                    window.location.hash = \"/station/\" + station._id + \"/code\";\n                    $.scrollTo(\"#s\" + station._id, 800);\n                }, 400); \n                console.log(\"onLoad id: \" + station._id);\n                //$.scrollTo(\"#s\" + station._id, 800);\n                $(\"body\").removeClass(\"adding\");\n                a.removeErrors();\n            });\n\n        });\n        this.post('#/stationXX"],[0,"', f"]],"start1":37670,"start2":37670,"length1":377,"length2":2332},{"diffs":[[0,"pp.subscription."],[1,"properties."],[0,"stations[data._i"]],"start1":40891,"start2":40891,"length1":32,"length2":43},{"diffs":[[0,"nLoad}); //\n"],[1,"                    //properties.stations\n"],[0,"            "]],"start1":40993,"start2":40993,"length1":24,"length2":66},{"diffs":[[0,"e);\n"],[-1,"            //alert(\"#/station/%s/%s\",typeof a, this.params.path);\n            //this.params.path == \"overview\" && a.setRecentTraffic();\n            //this.trigger('station.setup', station);\n            //this.trigger('station.setup', MyApp.subscription.stations[this.params.id]);\n"],[0,"    "]],"start1":42833,"start2":42833,"length1":289,"length2":8},{"diffs":[[0,"ar MyApp"],[-1,""],[1,"XX"],[0," = {\n   "]],"start1":45001,"start2":45001,"length1":16,"length2":18},{"diffs":[[0,"  {\n"],[-1,"                //MyApp.subscription = new myApplication({_id: that.user.subscription, callback: onInit});\n"],[0,"    "]],"start1":46101,"start2":46101,"length1":115,"length2":8},{"diffs":[[0,"    });\n"],[-1,"                \n"],[0,"        "]],"start1":46262,"start2":46262,"length1":33,"length2":16},{"diffs":[[0,") {\n"],[-1,"                    console.log(\"subscription._id: \" + subscription._id);\n"],[0,"    "]],"start1":46323,"start2":46323,"length1":82,"length2":8},{"diffs":[[0,"      }\n"],[-1,"                \n"],[0,"        "]],"start1":46459,"start2":46459,"length1":33,"length2":16},{"diffs":[[0,"            "],[-1,"//MyApp."],[0,"subscription"]],"start1":46539,"start2":46539,"length1":32,"length2":24},{"diffs":[[0,"tion"],[-1,"s['50dfa3ce09556aa365000004'].properties.stations['50e9be722eda7b7a55000002']\n                    console.log(\"stations: \" + JSON.stringify(MyApp.subscriptions[subscrip"],[1,".order.forEach(func"],[0,"tion"],[-1,"._id].properties.stations     ));\n                    "],[1,"(_id) {"],[0,"\n   "]],"start1":46559,"start2":46559,"length1":234,"length2":38},{"diffs":[[0,"    "],[-1,"  /*\n"],[0,"      "],[-1,"             "],[1,"var station ="],[0," sub"]],"start1":46608,"start2":46608,"length1":32,"length2":27},{"diffs":[[0,"ion."],[-1,"order.forEach(function(_id) {\n                        console.log(\""],[0,"station"],[-1,"._id: \" + _id);\n                        console.log(\"names: \" + sub.selected)"],[1,"s[_id]"],[0,";\n  "]],"start1":46641,"start2":46641,"length1":159,"length2":21},{"diffs":[[0,"                "],[-1,"//"],[0,"$(\"#sites\").appe"]],"start1":46668,"start2":46668,"length1":34,"length2":32},{"diffs":[[0,"ate("],[-1,"a));\n                        //$(\"#s\" + a.id).html(ich.station_preview_template(a));\n                    });\n                    */\n                    MyApp.subscriptions[subscription._id].properties.stations.forEach(function(_id) {\n                        console.log(\"XXXXstation._id: \" + _id);\n                    });\n                }\n                /*\n                function onSetup(a) {\n                    console.log(\"onSetup: \" + JSON.stringify(a));\n                    $(\"#sites\").append(ich.site_template(a));\n                    $(\"#s\" + a."],[1,"station.properties)).hide().fadeIn(200);\n                        $(\"#s\" + station.properties._"],[0,"id)."]],"start1":46717,"start2":46717,"length1":564,"length2":102},{"diffs":[[0,"review_template("],[-1,"a"],[1,"station.properties"],[0,"));\n            "]],"start1":46837,"start2":46837,"length1":33,"length2":50},{"diffs":[[0,"    "],[-1,"//MyApp.meldSidebar();\n                };\n                */"],[1,"});\n                }"],[0,"\n   "]],"start1":46891,"start2":46891,"length1":68,"length2":29},{"diffs":[[0,"is;\n"],[-1,"            console.log(\"getUser\");\n"],[0,"    "]],"start1":50611,"start2":50611,"length1":44,"length2":8},{"diffs":[[0,"   MyApp"],[1,"XX"],[0," = MyApp"],[1,"XX"],[0," || {};\n"]],"start1":53566,"start2":53566,"length1":24,"length2":28},{"diffs":[[0,"ow.MyApp"],[1,"XX"],[0," = MyApp"],[1,"XX"],[0,";\n    }\n"]],"start1":54058,"start2":54058,"length1":24,"length2":28},{"diffs":[[0,"f (MyApp"],[1,"XX"],[0,".$) {\n  "]],"start1":54138,"start2":54138,"length1":16,"length2":18},{"diffs":[[0,"   MyApp"],[1,"XX"],[0,".$(funct"]],"start1":54163,"start2":54163,"length1":16,"length2":18},{"diffs":[[0,"                "],[1,"//"],[0,"MyApp"],[1,"XX"],[0,".domready();\n   "]],"start1":54190,"start2":54190,"length1":37,"length2":41},{"diffs":[[0,"        "],[1,"//"],[0,"MyApp"],[1,"XX"],[0,".domread"]],"start1":54341,"start2":54341,"length1":21,"length2":25},{"diffs":[[0,"\";\n    \n    "],[-1,"    "],[1,""],[0,"////////////"]],"start1":54891,"start2":54891,"length1":28,"length2":24},{"diffs":[[0," $(\""],[-1,"a.toggle_delete\").live"],[1,"#new_subscription a.cancel\").on"],[0,"(\"cl"]],"start1":55287,"start2":55287,"length1":30,"length2":39},{"diffs":[[0,"urn "],[-1,"$(\"#site_content\").toggleClass(\"delete\"), !1;\n    });\n\n    ///////////////////////////////////////////////////////////////////////////\n    // Custom jQuery Functions                                               //\n    ///////////////////////////////////////////////////////////////////////////\n    $.fn.displayErrors = function(a, b) {\n        var c = this.removeErrors();\n        c.parent().addClass(\"error\");\n        for (var key in a) {\n            var d = b ? b + \"[\" + key + \"]\" : key;\n            var e = a[key].join(\", \");\n            console.log(\"a[%s] = %s\", key, e);            \n            var f = '<strong class=\"error_explanation\">' + e + \"</strong>\";\n            c.find('[name=\"' + d + '\"]').addClass(\"error\").closest(\"p\").append(f);\n        }\n        var g = c.closest(\"section\");\n        return g.length > 0 && g.trigger(\"resize.g\", [c.closest(\".panel\").height()]), this"],[1,"window.location.hash = \"#/\", $(\"body\").removeClass(\"add_subscription\"), !1"],[0,";\n    }"],[1,")"],[0,";\n    $"],[-1,".fn.removeErrors = function() {\n        this.parent().removeClass(\"error\").find(\"input.error\").removeClass(\"error\"), this.find(\"strong.error_explanation\").remove();\n        var a = this.closest(\"section\");\n        return a.length > 0 && a.trigger(\"resize.g\", [this.closest(\".panel\").height()]), this;\n    };\n    $.fn.labelize ="],[1,"(\"a.toggle_delete\").live(\"click\","],[0," fun"]],"start1":55357,"start2":55357,"length1":1236,"length2":130},{"diffs":[[0,"click\", function"],[1," "],[0,"() {\n        ret"]],"start1":55476,"start2":55476,"length1":32,"length2":33},{"diffs":[[0,"urn "],[-1,"this.focus(function() {\n            $(this).val() == $(this).attr(\"title\") && ($(this).removeClass(\"labelized\"), $(this).val(\"\"))\n        }).blur(function() {\n            $.trim($(this).val()) == \"\" && ($(this).addClass(\"labelized\"), $(this).val($(this).attr(\"title\")))\n        }).blur().each(function() {\n            var b = $(this);\n            $(this.form).submit(function($) {\n                b.focus()\n            })\n        })\n    };\n  "],[1,"$(\"#site_content\").toggleClass(\"delete\"), !1;\n    });\n"],[0,"  \n "]],"start1":55509,"start2":55509,"length1":450,"length2":62}]],"length":65268,"saved":false}
{"ts":1357746083734,"patch":[[{"diffs":[[0,"d];\n"],[-1,"            //MyApp.subscription.setSelected(this.params.id);\n"],[0,"    "]],"start1":42671,"start2":42671,"length1":70,"length2":8}]],"length":65206,"saved":false}
{"ts":1357746087315,"patch":[[{"diffs":[[0,"h);\n"],[-1,"            //var a = MyApp.subscription.getStationById(this.params.id);\n            //console.log(\"MyApp.subscription.getStationById = \" + JSON.stringify(a));\n            //alert(typeof this.params.id);\n            //alert(MyApp.subscription.stations[this.params.id].name);\n"],[0,"    "]],"start1":42292,"start2":42292,"length1":283,"length2":8}]],"length":64931,"saved":false}
{"ts":1357746089839,"patch":[[{"diffs":[[0,") {\n"],[-1,"            //return;\n            //var a = MyApp.stations[this.params.id];\n"],[0,"    "]],"start1":42125,"start2":42125,"length1":84,"length2":8}]],"length":64855,"saved":false}
{"ts":1357746248942,"patch":[[{"diffs":[[0,") {\n"],[-1,"            console.log(\"getStationById(%s)\", id);\n"],[0,"    "]],"start1":18457,"start2":18457,"length1":59,"length2":8}]],"length":64804,"saved":false}
{"ts":1357746279062,"patch":[[{"diffs":[[0,", data),"],[-1," "],[0,"\n       "]],"start1":26035,"start2":26035,"length1":17,"length2":16}]],"length":64803,"saved":false}
{"ts":1357746483858,"patch":[[{"diffs":[[0,"});\n"],[-1,"        this.bind('showSite', function(e, data) {\n            var a = this;\n            var b = $(\"#s\" + data['my_data'].id);\n            if (b.hasClass(\"current\")) return !0;\n            $(\"div.site.current\").removeClass(\"current\");\n            b.addClass(\"current\");\n            $(\"#data\").html(ich.site_data_template({title: \"hello\", id: 1234, mine: false}));\n            //$(\"#data\").html(ich.site_data_template(this)), \n            //$(\"body\").addClass(\"view-nav\");\n            //alert(data['my_data'].id);\n        });\n"],[0,"    "]],"start1":24667,"start2":24667,"length1":532,"length2":8}]],"length":64279,"saved":false}
{"ts":1357746513065,"patch":[[{"diffs":[[0,"n';\n"],[-1,"        this.bind('getSubscription', function(e, data) {\n            //console.log(\"getSubscription\");\n            MyApp.subscription = new myApplication({onSetup: onSetup});\n            function onSetup(a) {\n                console.log(\"onSetup: \" + JSON.stringify(a));\n                $(\"#sites\").append(ich.site_template(a));\n                $(\"#s\" + a.id).html(ich.station_preview_template(a));\n                //MyApp.meldSidebar();\n            };\n        });\n"],[0,"    "]],"start1":23354,"start2":23354,"length1":473,"length2":8}]],"length":63814,"saved":false}
{"ts":1357746546443,"patch":[[{"diffs":[[0,"///\n        // S"],[-1,"ta"],[1,"ubscrip"],[0,"tion Routes     "]],"start1":36710,"start2":36710,"length1":34,"length2":39}]],"length":63819,"saved":false}
{"ts":1357746550369,"patch":[[{"diffs":[[0,"                "],[-1,"     "],[0,"//\n        /////"]],"start1":36775,"start2":36775,"length1":37,"length2":32}]],"length":63814,"saved":false}
{"ts":1357746625155,"patch":[[{"diffs":[[0," $(function() {\n"],[1,"        window.sa\n"],[0,"        app.run("]],"start1":43192,"start2":43192,"length1":32,"length2":50}]],"length":63832,"saved":false}
{"ts":1357746626205,"patch":[[{"diffs":[[0,"indow.sa"],[1,"mmya"],[0,"\n       "]],"start1":43217,"start2":43217,"length1":16,"length2":20}]],"length":63836,"saved":false}
{"ts":1357746628468,"patch":[[{"diffs":[[0,"ow.sammy"],[-1,"a"],[1,"App = "],[0,"\n       "]],"start1":43220,"start2":43220,"length1":17,"length2":22}]],"length":63841,"saved":false}
{"ts":1357746629584,"patch":[[{"diffs":[[0,"myApp = "],[1,"app"],[0,"\n       "]],"start1":43226,"start2":43226,"length1":16,"length2":19}]],"length":63844,"saved":false}
{"ts":1357746630970,"patch":[[{"diffs":[[0,"pp = app"],[1,";"],[0,"\n       "]],"start1":43229,"start2":43229,"length1":16,"length2":17}]],"length":63845,"saved":false}
{"ts":1357746744502,"patch":[[{"diffs":[[0,", function () {\n"],[1,"            console\n"],[0,"            cons"]],"start1":41072,"start2":41072,"length1":32,"length2":52}]],"length":63865,"saved":false}
{"ts":1357746746562,"patch":[[{"diffs":[[0," console"],[1,".log()"],[0,"\n       "]],"start1":41099,"start2":41099,"length1":16,"length2":22}]],"length":63871,"saved":false}
{"ts":1357746747579,"patch":[[{"diffs":[[0,"ole.log("],[1,"th"],[0,")\n      "]],"start1":41104,"start2":41104,"length1":16,"length2":18}]],"length":63873,"saved":false}
{"ts":1357746748948,"patch":[[{"diffs":[[0,"e.log(th"],[1,"is.p"],[0,")\n      "]],"start1":41106,"start2":41106,"length1":16,"length2":20}]],"length":63877,"saved":false}
{"ts":1357746751661,"patch":[[{"diffs":[[0,"g(this.p"],[1,"arams"],[0,")\n      "]],"start1":41110,"start2":41110,"length1":16,"length2":21}]],"length":63882,"saved":false}
{"ts":1357747381857,"patch":[[{"diffs":[[0,"allback)"],[-1,"\n       "],[0," {\n     "]],"start1":14629,"start2":14629,"length1":24,"length2":16}]],"length":63874,"saved":false}
{"ts":1357747414796,"patch":[[{"diffs":[[0,"      data: that"],[1,".properties"],[0,",\n              "]],"start1":22643,"start2":22643,"length1":32,"length2":43}]],"length":63885,"saved":false}
{"ts":1357747498539,"patch":[[{"diffs":[[0,"ar that = this;\n"],[1,"            var options = $.extend({}, this.properties, options);\n"],[0,"            cons"]],"start1":22428,"start2":22428,"length1":32,"length2":98}]],"length":63951,"saved":false}
{"ts":1357747532344,"patch":[[{"diffs":[[0,"unction("],[1,"options, "],[0,"callback"]],"start1":22395,"start2":22395,"length1":16,"length2":25}]],"length":63960,"saved":false}
{"ts":1357747547280,"patch":[[{"diffs":[[0,"            var "],[-1,"option"],[1,"propertie"],[0,"s = $.extend({},"]],"start1":22453,"start2":22453,"length1":38,"length2":41}]],"length":63963,"saved":false}
{"ts":1357747548747,"patch":[[{"diffs":[[0,"pdate: function("],[-1,"option"],[1,"propertie"],[0,"s, callback) {\n "]],"start1":22387,"start2":22387,"length1":38,"length2":41}]],"length":63966,"saved":false}
{"ts":1357747550761,"patch":[[{"diffs":[[0,"his.properties, "],[-1,"option"],[1,"propertie"],[0,"s);\n            "]],"start1":22499,"start2":22499,"length1":38,"length2":41}]],"length":63969,"saved":false}
{"ts":1357747563182,"patch":[[{"diffs":[[0,"  data: "],[-1,"that."],[0,"properti"]],"start1":22731,"start2":22731,"length1":21,"length2":16}]],"length":63964,"saved":false}
{"ts":1357747570963,"patch":[[{"diffs":[[0,"ected: function("],[1,"_"],[0,"id) {\n          "]],"start1":22108,"start2":22108,"length1":32,"length2":33}]],"length":63965,"saved":false}
{"ts":1357747577270,"patch":[[{"diffs":[[0,".update("],[1,"{},"],[0,"onUpdate"]],"start1":22176,"start2":22176,"length1":16,"length2":19}]],"length":63968,"saved":false}
{"ts":1357747580121,"patch":[[{"diffs":[[0,"update({"],[1,"_i"],[0,"},onUpda"]],"start1":22177,"start2":22177,"length1":16,"length2":18}]],"length":63970,"saved":false}
{"ts":1357747581148,"patch":[[{"diffs":[[0,"date({_i"],[1,"d:"],[0,"},onUpda"]],"start1":22179,"start2":22179,"length1":16,"length2":18}]],"length":63972,"saved":false}
{"ts":1357747582261,"patch":[[{"diffs":[[0,"te({_id:"],[1," "],[0,"},onUpda"]],"start1":22181,"start2":22181,"length1":16,"length2":17}]],"length":63973,"saved":false}
{"ts":1357747583202,"patch":[[{"diffs":[[0,"e({_id: "],[1,"_i"],[0,"},onUpda"]],"start1":22182,"start2":22182,"length1":16,"length2":18}]],"length":63975,"saved":false}
{"ts":1357747584670,"patch":[[{"diffs":[[0,"{_id: _i"],[1,"d"],[0,"},onUpda"]],"start1":22184,"start2":22184,"length1":16,"length2":17}]],"length":63976,"saved":false}
{"ts":1357747594776,"patch":[[{"diffs":[[0,"ected = "],[1,"data."],[0,"id;\n    "]],"start1":22280,"start2":22280,"length1":16,"length2":21}]],"length":63981,"saved":false}
{"ts":1357747596358,"patch":[[{"diffs":[[0," = data."],[1,"_"],[0,"id;\n    "]],"start1":22285,"start2":22285,"length1":16,"length2":17}]],"length":63982,"saved":false}
{"ts":1357747641825,"patch":[[{"diffs":[[0,"e/\" + th"],[-1,"is"],[1,"at"],[0,"._id,\n  "]],"start1":22656,"start2":22656,"length1":18,"length2":18}]],"length":63982,"saved":false}
{"ts":1357747660376,"patch":[[{"diffs":[[0,"ate/\" + "],[-1,"that"],[1,"properties"],[0,"._id,\n  "]],"start1":22654,"start2":22654,"length1":20,"length2":26}]],"length":63988,"saved":false}
{"ts":1357750966559,"patch":[[{"diffs":[[0,"d: _id},"],[1," "],[0,"onUpdate"]],"start1":22187,"start2":22187,"length1":16,"length2":17}]],"length":63989,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357913634872,"patch":[[{"diffs":[[0,"        "],[-1,"\n                "],[0,""],[1,""],[0,"error: f"]],"start1":7571,"start2":7571,"length1":33,"length2":16},{"diffs":[[0," },\n"],[-1,"        /*\n        setupx: function (a) {\n            var that = this;\n            that.id = a._id;\n            $.ajax({\n                url: \"/station/getbyid/\" + a._id,\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    //console.log(\"Station[\" + data._id + \"] successfully created\");\n                    that._id = data._id,\n                    that.id = data._id,\n                    that.name = data.name;\n                    that.type = data.type;\n                    that.temperature = data.temperature;\n                    that.humidity = data.humidity;\n                    that.latitude = data.latitude;\n                    that.longitude = data.longitude;\n                    //Preserve the original defaults by passing an empty object as the target\n                    //that = $.extend({}, that, data);\n                    a.onLoad(that);\n                },\n                \n                error: function (b) {\n                    var c = $.parseJSON(b.responseText);\n                    alert(c.errors);\n                },\n                complete: function () {                                \n                }\n            });\n        },\n        */\n"],[0,"    "]],"start1":7805,"start2":7805,"length1":1268,"length2":8},{"diffs":[[0,"rror: function ("],[-1,"b"],[1,"jqXHR, status, error"],[0,") {\n            "]],"start1":8201,"start2":8201,"length1":33,"length2":52},{"diffs":[[0,"    "],[-1,"var c = $.parseJSON(b.responseText);\n                    alert(c.errors"],[1,"console.log(jqXHR.responseText"],[0,");\n "]],"start1":8257,"start2":8257,"length1":79,"length2":38},{"diffs":[[0," },\n"],[-1,"        setup2: function (a) {\n            var that = this;\n            //this.properties = $.observable(this.properties);\n            this.onSetup = a.onSetup;\n            this.properties.order.forEach(function(_id) {\n                console.log(\"loading station _id: \" + _id);\n                $.ajax({\n                    url: \"/station/getbyid/\" + _id,\n                    type: \"GET\",\n                    dataType: \"json\",\n                    success: function (data, textStatus, jqXHR) {\n                        console.log(\"/station/getbyid---: \" + JSON.stringify(data._id));\n                        that.properties.stations[data._id] = new Station({_id: data._id, type: data.type, onLoad: onLoad}); //that.stations[b[i]._id] = \n                        console.log(\"Attaching station id: \" + that.properties.stations[data._id].id);\n                        \n                        function onLoad(station) {\n                            station.isReady = true;\n                            console.log(\"is onLoad ready: \" + station.isReady + \" id: \" + station._id);\n                            a.onSetup(station);\n                        }\n                    },\n                    error: function (jqXHR, status, error) {\n                        console.log(jqXHR.responseText);\n                    },\n                    complete: function () {\n                    }\n                });\n            });\n        },\n        setupOLD: function (a) {\n            this.onSetup = a.onSetup;\n            var that = this;\n            $.ajax({\n                url: \"/station/getall\",\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (b) {\n                    for (var i = 0; i < b.length; i++) {\n                        that.properties.stations[b[i]._id] = new Station({_id: b[i]._id, type: b[i].type, onLoad: onLoad}); //that.stations[b[i]._id] = \n                        console.log(\"Attaching station id: \" + that.properties.stations[b[i]._id].id);\n                    }\n                    function onLoad(station) {\n                        station.isReady = true;\n                        console.log(\"is onLoad ready: \" + station.isReady + \" id: \" + station._id);\n                        a.onSetup(station);\n                    }\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });\n        },\n"],[0,"    "]],"start1":14262,"start2":14262,"length1":2554,"length2":8},{"diffs":[[0,") {\n"],[-1,"            console.log(\"getStationById(%s) = %s\", id, JSON.stringify(this.properties.stations[id]));\n"],[0,"    "]],"start1":14604,"start2":14604,"length1":110,"length2":8},{"diffs":[[0,"tations:"],[-1," "],[0," functio"]],"start1":15038,"start2":15038,"length1":17,"length2":16},{"diffs":[[0,"function"],[-1," "],[0,"(callbac"]],"start1":15047,"start2":15047,"length1":17,"length2":16},{"diffs":[[0,") {\n"],[-1,"                    //var c = $.parseJSON(jqXHR);\n"],[0,"    "]],"start1":15388,"start2":15388,"length1":58,"length2":8},{"diffs":[[0,"');\n"],[-1,"            //$(\"#sites\").append(ich.site_template(data));\n"],[0,"    "]],"start1":19857,"start2":19857,"length1":67,"length2":8},{"diffs":[[0,"));\n"],[-1,"            //this.trigger(\"show_station.g\");\n            //this.trigger('showSite', {my_data: this.params});"],[0,""],[1,""],[0,"\n   "]],"start1":19929,"start2":19929,"length1":117,"length2":8},{"diffs":[[0,"s).remove();});\n"],[1,"                //a.hide(\"slide\", { direction: \"right\" }, 'swing');\n"],[0,"                "]],"start1":26841,"start2":26841,"length1":32,"length2":100},{"diffs":[[0,"id]\n        });\n"],[1,"        \n"],[0,"        this.get"]],"start1":27080,"start2":27080,"length1":32,"length2":41},{"diffs":[[0,"\");\n        });\n"],[-1,"\n"],[0,"        ////////"]],"start1":32634,"start2":32634,"length1":33,"length2":32},{"diffs":[[0,"        });\n"],[-1,"\n"],[0,"        });\n"]],"start1":34918,"start2":34918,"length1":25,"length2":24},{"diffs":[[0," })\n"],[-1,"        // Station routes\n"],[0,"    "]],"start1":39203,"start2":39203,"length1":34,"length2":8},{"diffs":[[0,"    "],[-1,"    //app.trigger('getSubscription', {time: new Date()});\n    });\n    \n    ///////////////////////////////////////////////////////////////////////////\n    // Main Client application                                               //\n    ///////////////////////////////////////////////////////////////////////////\n    var MyAppXX = {\n        module: { \n            VERSION: \"0.1.2.3\",\n            license: {},\n            dependencies: {},\n            author: \"\",\n        },\n        $: (typeof window !== 'undefined') ? window.jQuery || window.Zepto || null : null,\n        timeout: null,\n        clients: null,\n        connection_count: 0,\n        subscription: {},\n        subscriptions: [],\n        mousecoords: {\n            pageX: 0, \n            pageY: 0,\n        },\n        properties: {\n            delay: 10,\n            reconnect: true,\n            socket: null,\n            stdinp: null,\n            stdout: null,\n            stderr: null,\n        },\n        user: {\n                name: \"\", \n                id: \"\", \n                last_name: null, \n                first_name: null, \n                email: \"\",\n                subscriptions: [],\n                subscription: null,\n        },\n        init: function(options) {\n            var that = this;\n            console.log(\"MyApp.options\")\n            this.getUser({callback: gotUser})\n            \n            function gotUser(account)\n            {\n                that.user.subscriptions.forEach(function(_id) {\n                    that.getSubscription({_id: _id, callback: gotSubscription});\n                });\n                function gotSubscription(subscription) {\n                    MyApp.subscriptions[subscription._id] = new myApplication({_id: subscription._id, callback: onInit});\n                }\n                function onInit(subscription)\n                {\n                    subscription.order.forEach(function(_id) {\n                        var station = subscription.stations[_id];\n                        $(\"#sites\").append(ich.site_template(station.properties)).hide().fadeIn(200);\n                        $(\"#s\" + station.properties._id).html(ich.station_preview_template(station.properties));\n                    });\n                }\n            }\n            return;\n            var that = this;\n            MyApp.subscription = new myApplication({onSetup: onSetup});\n            function onSetup(a) {\n                $(\"#sites\").append(ich.site_template(a));\n                $(\"#s\" + a.id).html(ich.station_preview_template(a));\n            };\n        },\n        start: function(options) {\n            var that = this;\n            //a === 0 ? app.runRoute(\"get\", \"#/map\") : window.location.hash == \"#/\" && (window.location.hash = \"\");\n            //jQuery.get('http://laboratory.bmaggi.c9.io/cors.php', null, function(data){alert(data);});\n            // new myApplication({onSetup: onSetup});\n            \n            $.ajax({\n                url: '/application/start',\n                type: 'GET',\n                dataType: \"json\",\n                success: function(data, textStatus, jqXHR) {\n                    //that.subscription subscription: {},\n                },\n                error: function (jqXHR, status, error) {\n                    //c.removeClass(\"loading\")\n                },\n                complete: function () {\n                \n                },\n            });\n        },\n        getSubscription: function(options) {\n            var that = this;\n            console.log(\"MyApp.getSubscription(%s)\", options._id);\n            $.ajax({\n                url: \"/subscription/getbyid/\" + options._id,\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    console.log(data);\n                    //MyApp.user.subscription = new myApplication({_id: that.user.subscription, callback: onInit});\n                    if($.isFunction(options.callback))\n                    {\n                        options.callback(data);\n                    }\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {\n                }\n            });\n        },\n        setSubscription: function(_id) {\n            var that = this;\n            $.ajax({\n                url: \"/account/subscription\",\n                type: \"PUT\",\n                dataType: \"json\",\n                data: {subscription: _id},\n                success: function (data, textStatus, jqXHR) {\n                    that.user.subscription = data.subscription;\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });      \n        },\n        createSubscription: function(options) {\n            var that = this;\n            var options = $.extend({}, this.properties, options);\n            $.ajax({\n                url: \"/subscription/create\",\n                type: \"POST\",\n                dataType: \"json\",\n                data: options,\n                success: function (data, textStatus, jqXHR) {\n                    that.properties = $.extend({}, that.properties, data);\n                    that.properties.isReady = true;\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n                complete: function () {                                \n                }\n            });    \n        },\n        reset: function () {},\n        setUser: function (a) {\n            //this.user = a.user, a.subscription && (this.subscription = new Subscription(a.subscription))\n        },\n        getUser: function(options) {\n            var that = this;\n            $.ajax({\n                url: \"/account/getAccount\",\n                type: \"GET\",\n                dataType: \"json\",\n                success: function (data, textStatus, jqXHR) {\n                    that.user = $.extend({}, that.user, data);\n                    options.callback(that.user);\n                },\n                error: function (jqXHR, status, error) {\n                    console.log(jqXHR.responseText);\n                },\n            });    \n        },\n        getSettings: function(a) {\n                /*\n                $(\"#sites div.current\").removeClass(\"current\"), \n                $(\"#data\").html(ich.account_template(Gauges.user)), \n                $('div.nav a[href=\"#/account\"]').closest(\"li\").addClass(\"current\"), \n                $(\"#site_content\").html(ich.my_info_template(Gauges.user))  \n                */\n        },\n        meldSidebar: function () {\n            var a = $(\"#sites div.current\"),\n                b = $(\"#data\");\n            $(window).scrollTop() == 0 ? $(\"#sites\").removeClass(\"topcut\") : $(\"#sites\").addClass(\"topcut\"), $(\"#sites\").height() > b.outerHeight() ? $(\"#sites\").addClass(\"bottomcut\") : $(\"#sites\").removeClass(\"bottomcut\");\n            if (a.length > 0) {\n                var c = a.offset().top,\n                    d = c + a.outerHeight(),\n                    e = b.offset().top,\n                    f = e + b.outerHeight(),\n                    g = a.attr(\"id\") == $(\"#sites > div:first\").attr(\"id\") ? 0 : 10;\n                a.length > 0 && c >= e + g && d < f - 10 ? $(\"#sites\").addClass(\"meld\") : $(\"#sites\").removeClass(\"meld\")\n                }\n        },\n        resize: function() {\n            console.log(\"resize\");\n            MyApp.meldSidebar();\n            \n            //$(\"#full_map\").is(\":visible\") && (Gauges.resize_timeout && clearTimeout(Gauges.resize_timeout), \n            //Gauges.resize_timeout = setTimeout(Gauges.showScreenMap, 300));\n        },\n        formatNumber: function (a) {\n            a += \"\";\n            var b = /(\\d+)(\\d{3})/;\n            while (b.test(a)) a = a.replace(b, \"$1,$2\");  // ',' thousand separator\n            return a\n        },\n        parseQueryString: function (a) {\n            if (a.indexOf(\"?\") == -1) return {\n                date: \"recent\"\n            };\n            var b = {};\n            return _.each(a.split(\"?\")[1].split(\"&\"), function (a) {\n                var c = a.split(\"=\");\n                b[c[0]] = c[1]\n            }), b\n        },\n        overview: function () {\n            return {\n                views: this.formatNumber(this.today.views),\n                people: this.formatNumber(this.today.people)\n            }\n        },\n        domready: function() {\n            console.log(\"DOMContentLoaded starting MyApp.version: %f\", this.module.VERSION);\n            this.init({user: 'uid'});\n            $(\"body\").height(0);\n            $(\"#data\").html(ich.greetings_template(this));\n        }\n    };\n    MyAppXX = MyAppXX || {};\n\n    ///////////////////////////////////////////////////////////////////////////\n    // Use CommonJS if applicable                                            //\n    ///////////////////////////////////////////////////////////////////////////\n    console.log(\"using commons\")\n    if (typeof require !== 'undefined') {\n        //module.exports = myApplication;\n    } else {\n        // else attach it to the window\n        console.log(\"attachinng plugin\")\n        window.MyAppXX = MyAppXX;\n    }\n    if (typeof document !== 'undefined') {\n        if (MyAppXX.$) {\n            MyAppXX.$(function () {\n                //MyAppXX.domready();\n            });\n        } else {\n            document.addEventListener('DOMContentLoaded', function () {\n                //MyAppXX.domready();\n            }, true);\n        }\n    }"],[1,"});\n"],[0,"\n})("]],"start1":39284,"start2":39284,"length1":9731,"length2":12},{"diffs":[[0,"o);\n"],[-1,"\n\n///////////////////////////////////////////////////////////////////////////////\n// Google MAPS bindings                                                      //\n///////////////////////////////////////////////////////////////////////////////\n$(document).ready(function() {\n    \"use strict\";\n    \n    $(function initialize() {\n        var myLatlng = new google.maps.LatLng(0, 0) //(-34.6036, -58.3817);\n        var image = 'images/markers/anniversary.png'\n        var myOptions = {\n          zoom: 1,\n          center: myLatlng,\n          mapTypeId: google.maps.MapTypeId.ROADMAP\n        }        \n        var map = new google.maps.Map(document.getElementById(\"map_canvas\"), myOptions);\n        \n        var contentString = \n            '<div id=\"infowindow\">' +\n            'Galaconcert<br />' +\n            'Jaarbeurslaan 2-6<br />' +\n            '3690 Genk' +\n            '</div>'\n        ;\n        var infowindow = new google.maps.InfoWindow();\n        \n        \n        var marker = new google.maps.Marker({\n            position: myLatlng,\n            map: map,\n            title: 'Galaconcert',\n            icon: image\n        });\n        var infowindow = new google.maps.InfoWindow(); \n        \n        var input = document.getElementById('new_location');         \n        var autocomplete = new google.maps.places.Autocomplete(input, {\n            types: [\"geocode\"]\n        });\n        autocomplete.bindTo('bounds', map); \n        \n     \n        google.maps.event.addListener(autocomplete, 'place_changed', function() {\n            infowindow.close();\n            var place = autocomplete.getPlace();\n            if (place.geometry.viewport) {\n                map.fitBounds(place.geometry.viewport);\n            } else {\n                map.setCenter(place.geometry.location);\n                map.setZoom(17);  \n            }\n            moveMarker(place.name, place.geometry.location);\n        });  \n        \n        $(input).focusin(function () {\n            $(document).keypress(function (e) {\n                if (e.which == 13) {\n                     selectFirstResult();   \n                }\n            });\n        });\n        $(input).focusout(function () {\n            if(!$(\".pac-container\").is(\":focus\") && !$(\".pac-container\").is(\":visible\"))\n                selectFirstResult();\n        });\n        function selectFirstResult() {\n            infowindow.close();\n            $(\".pac-container\").hide();\n            var firstResult = $(\".pac-container .pac-item:first\").text();\n            console.log(\"selectFirstResult: \" + firstResult)\n            \n            var geocoder = new google.maps.Geocoder();\n            geocoder.geocode({\"address\":firstResult }, function(results, status) {\n                if (status == google.maps.GeocoderStatus.OK) {\n                    var lat = results[0].geometry.location.lat(),\n                        lng = results[0].geometry.location.lng(),\n                        placeName = results[0].address_components[0].long_name,\n                        latlng = new google.maps.LatLng(lat, lng);\n                    \n                    moveMarker(placeName, latlng);\n                    $(input).val(firstResult);\n                }\n            });   \n        }\n        var div = document.createElement('DIV');\n        $(div).html(ich.infobubble_template({name: $(input).val()}));\n        google.maps.event.addListener(marker, 'click', function() {\n            //infowindow.setContent(contentString);\n            //infowindow.open(map, marker);\n            infoBubble2.setContent(div);\n            infoBubble2.open(map, marker);\n        });\n        \n        function moveMarker(placeName, latlng){\n            marker.setIcon(image);\n            marker.setPosition(latlng);\n            infowindow.close();\n            //infowindow.setContent(contentString);\n            infoBubble2.setContent(div);\n            //infowindow.open(map, marker);\n            //infoBubble2.open(map, marker);\n        }\n        \n        var infoBubble2 = new InfoBubble({\n          map: map,\n          content: '<div class=\"signin\"><form action=\"/signin\" method=\"post\"><p class=\"phoneytext\">Hello There</p></form></div>',\n          position: new google.maps.LatLng(-34.6036, -58.3817),\n          shadowStyle: 1,\n          padding: 0,\n          backgroundColor: 'rgb(57,57,57)',\n          borderRadius: 4,\n          arrowSize: 10,\n          borderWidth: 1,\n          borderColor: '#2c2c2c',\n          disableAutoPan: true,\n          hideCloseButton: true,\n          arrowPosition: 30,\n          backgroundClassName: 'signin',\n          arrowStyle: 2\n        });\n    });\n});"]],"start1":45545,"start2":45545,"length1":4607,"length2":4}]],"length":45549,"saved":false}
{"ts":1357914132053,"patch":[[{"diffs":[[0,"selected: null,\n"],[1,"            last_7_days: [\n                { views_size: '05px', people_size: '25px' },\n                { views_size: '10px', people_size: '20px' },\n                { views_size: '15px', people_size: '15px' },\n                { views_size: '20px', people_size: '10px' },\n                { views_size: '25px', people_size: '05px' },\n                { views_size: '20px', people_size: '00px' },\n                { views_size: '10px', people_size: '10px' },\n            ];\n"],[0,"        },\n     "]],"start1":10232,"start2":10232,"length1":32,"length2":501}]],"length":46018,"saved":false}
{"ts":1357914138690,"patch":[[{"diffs":[[0,"       ]"],[-1,";"],[0,"\n       "]],"start1":10707,"start2":10707,"length1":17,"length2":16}]],"length":46017,"saved":false}
{"ts":1357914412948,"patch":[[{"diffs":[[0,"selected: null,\n"],[1,"            overview: true,\n"],[0,"            last"]],"start1":10232,"start2":10232,"length1":32,"length2":60}]],"length":46045,"saved":false}
{"ts":1357914462062,"patch":[[{"diffs":[[0,"      overview: "],[-1,"tru"],[1,"fals"],[0,"e,\n            m"]],"start1":5667,"start2":5667,"length1":35,"length2":36}]],"length":46046,"saved":false}
{"ts":1357914484380,"patch":[[{"diffs":[[0,"erview: "],[-1,"fals"],[1,"tru"],[0,"e,\n     "]],"start1":5675,"start2":5675,"length1":20,"length2":19}]],"length":46045,"saved":false}
{"ts":1357914499143,"patch":[[{"diffs":[[0,"null"],[-1,",\n            overview: true,\n            last_7_days: [\n                { views_size: '05px', people_size: '25px' },\n                { views_size: '10px', people_size: '20px' },\n                { views_size: '15px', people_size: '15px' },\n                { views_size: '20px', people_size: '10px' },\n                { views_size: '25px', people_size: '05px' },\n                { views_size: '20px', people_size: '00px' },\n                { views_size: '10px', people_size: '10px' },\n            ]"],[0,"\n   "]],"start1":10242,"start2":10242,"length1":505,"length2":8}]],"length":45548,"saved":false}
{"ts":1357914518979,"patch":[[{"diffs":[[0,"     ],\n"],[1,"            last_7_days: [\n                { views_size: '05px', people_size: '25px' },\n                { views_size: '10px', people_size: '20px' },\n                { views_size: '15px', people_size: '15px' },\n                { views_size: '20px', people_size: '10px' },\n                { views_size: '25px', people_size: '05px' },\n                { views_size: '20px', people_size: '00px' },\n                { views_size: '10px', people_size: '10px' },\n            ]\n"],[0,"        "]],"start1":6967,"start2":6967,"length1":16,"length2":484}]],"length":46016,"saved":false}
{"ts":1357914546364,"patch":[[{"diffs":[[0,"7_days: "],[-1,"["],[1,"{"],[0,"\n       "]],"start1":6992,"start2":6992,"length1":17,"length2":17},{"diffs":[[0,"        "],[-1,"]"],[1,"}"],[0,"\n       "]],"start1":7433,"start2":7433,"length1":17,"length2":17}]],"length":46016,"saved":false}
{"ts":1357914584048,"patch":[[{"diffs":[[0,"7_days: "],[-1,"{"],[1,"["],[0,"\n       "]],"start1":6992,"start2":6992,"length1":17,"length2":17},{"diffs":[[0," },\n            "],[-1,"}"],[1,"]"],[0,"\n        },\n    "]],"start1":7425,"start2":7425,"length1":33,"length2":33}]],"length":46016,"saved":false}
{"ts":1357914794035,"patch":[[{"diffs":[[0,"              { "],[-1,"views"],[1,"temperature"],[0,"_size: '05px', p"]],"start1":7004,"start2":7004,"length1":37,"length2":43},{"diffs":[[0,"ze: '05px', "],[-1,"people"],[1,"humidity"],[0,"_size: '25px"]],"start1":7034,"start2":7034,"length1":30,"length2":32},{"diffs":[[0,"              { "],[-1,"views"],[1,"temperature"],[0,"_size: '10px', p"]],"start1":7073,"start2":7073,"length1":37,"length2":43},{"diffs":[[0,"e_size: '10px', "],[-1,"people"],[1,"humidity"],[0,"_size: '20px' },"]],"start1":7099,"start2":7099,"length1":38,"length2":40},{"diffs":[[0,"              { "],[-1,"views"],[1,"temperature"],[0,"_size: '15px', p"]],"start1":7142,"start2":7142,"length1":37,"length2":43},{"diffs":[[0,"ze: '15px', "],[-1,"people"],[1,"humidity"],[0,"_size: '15px"]],"start1":7172,"start2":7172,"length1":30,"length2":32},{"diffs":[[0,"              { "],[-1,"views"],[1,"temperature"],[0,"_size: '20px', p"]],"start1":7211,"start2":7211,"length1":37,"length2":43},{"diffs":[[0,"e_size: '20px', "],[-1,"people"],[1,"humidity"],[0,"_size: '10px' },"]],"start1":7237,"start2":7237,"length1":38,"length2":40},{"diffs":[[0,"              { "],[-1,"views"],[1,"temperature"],[0,"_size: '25px', p"]],"start1":7280,"start2":7280,"length1":37,"length2":43},{"diffs":[[0,"ze: '25px', "],[-1,"people"],[1,"humidity"],[0,"_size: '05px"]],"start1":7310,"start2":7310,"length1":30,"length2":32},{"diffs":[[0,"              { "],[-1,"views"],[1,"temperature"],[0,"_size: '20px', p"]],"start1":7349,"start2":7349,"length1":37,"length2":43},{"diffs":[[0,"ze: '20px', "],[-1,"people"],[1,"humidity"],[0,"_size: '00px"]],"start1":7379,"start2":7379,"length1":30,"length2":32},{"diffs":[[0,"  { "],[-1,"views"],[1,"temperature"],[0,"_siz"]],"start1":7430,"start2":7430,"length1":13,"length2":19},{"diffs":[[0,"x', "],[-1,"people"],[1,"humidity"],[0,"_siz"]],"start1":7456,"start2":7456,"length1":14,"length2":16}]],"length":46072,"saved":false}
{"ts":1357915218903,"patch":[[{"diffs":[[0,"7_days: "],[-1,"[\n                {"],[1,"function()\n            {\n                return [{temperature:\"5\", humidity:\"1\", day:11, date:\"January 11, 2013\","],[0," tempera"]],"start1":6992,"start2":6992,"length1":35,"length2":129},{"diffs":[[0,"re_size:"],[-1," '05px'"],[1,"\"40px\""],[0,", humidi"]],"start1":7123,"start2":7123,"length1":23,"length2":22},{"diffs":[[0,"ize:"],[-1," '25px' },\n                {"],[1,"\"9px\", weekend:false}, {temperature:\"0\", humidity:\"0\", day:10, date:\"January 10, 2013\","],[0," tem"]],"start1":7149,"start2":7149,"length1":36,"length2":95},{"diffs":[[0,"emperature_size:"],[-1," '10px'"],[1,"\"1px\""],[0,", humidity_size:"]],"start1":7242,"start2":7242,"length1":39,"length2":37},{"diffs":[[0,"ize:"],[-1," '20px' },\n                {"],[1,"\"1px\", weekend:false}, {temperature:\"0\", humidity:\"0\", day:9, date:\"January 9, 2013\","],[0," tem"]],"start1":7275,"start2":7275,"length1":36,"length2":93},{"diffs":[[0,"re_size:"],[-1," '15px'"],[1,"\"1px\""],[0,", humidi"]],"start1":7374,"start2":7374,"length1":23,"length2":21},{"diffs":[[0,"ize:"],[-1," '15px' },\n                {"],[1,"\"1px\", weekend:false}, {temperature:\"0\", humidity:\"0\", day:8, date:\"January 8, 2013\","],[0," tem"]],"start1":7399,"start2":7399,"length1":36,"length2":93},{"diffs":[[0,"emperature_size:"],[-1," '20px'"],[1,"\"1px\""],[0,", humidity_size:"]],"start1":7490,"start2":7490,"length1":39,"length2":37},{"diffs":[[0,"ize:"],[-1," '10px' },\n                {"],[1,"\"1px\", weekend:false}, {temperature:\"0\", humidity:\"0\", day:7, date:\"January 7, 2013\","],[0," tem"]],"start1":7523,"start2":7523,"length1":36,"length2":93},{"diffs":[[0,"ize:"],[-1," '25px'"],[1,"\"1px\""],[0,", hu"]],"start1":7626,"start2":7626,"length1":15,"length2":13},{"diffs":[[0,"ize:"],[-1," '05px' },\n                {"],[1,"\"1px\", weekend:false}, {temperature:\"0\", humidity:\"0\", day:6, date:\"January 6, 2013\","],[0," tem"]],"start1":7647,"start2":7647,"length1":36,"length2":93},{"diffs":[[0,"ize:"],[-1," '20px'"],[1,"\"1px\""],[0,", hu"]],"start1":7750,"start2":7750,"length1":15,"length2":13},{"diffs":[[0,"ize:"],[-1," '00px' },\n                {"],[1,"\"1px\", weekend:true}, {temperature:\"0\", humidity:\"0\", day:5, date:\"January 5, 2013\","],[0," tem"]],"start1":7771,"start2":7771,"length1":36,"length2":92},{"diffs":[[0,"re_size:"],[-1," '10px'"],[1,"\"1px\""],[0,", humidi"]],"start1":7869,"start2":7869,"length1":23,"length2":21},{"diffs":[[0,"ize:"],[-1," '10px' },"],[1,"\"1px\", weekend:true}];"],[0,"\n   "]],"start1":7894,"start2":7894,"length1":18,"length2":30},{"diffs":[[0,"        "],[-1,"]"],[1,"}"],[0,"\n       "]],"start1":7925,"start2":7925,"length1":17,"length2":17}]],"length":46508,"saved":false}
{"ts":1357915308108,"patch":[[{"diffs":[[0,"ays:"],[-1," function()\n            {\n                return"],[0," [{t"]],"start1":6995,"start2":6995,"length1":56,"length2":8},{"diffs":[[0,"d:true}]"],[-1,";\n            }"],[0,"\n       "]],"start1":7863,"start2":7863,"length1":31,"length2":16}]],"length":46445,"saved":false}
{"ts":1357915465686,"patch":[[{"diffs":[[0,"_days: ["],[1,"\n                "],[0,"{tempera"]],"start1":6993,"start2":6993,"length1":16,"length2":33},{"diffs":[[0,"weekend:false}, "],[1,"\n                "],[0,"{temperature:\"0\""]],"start1":7129,"start2":7129,"length1":32,"length2":49},{"diffs":[[0,"weekend:false}, "],[1,"\n                "],[0,"{temperature:\"0\""]],"start1":7272,"start2":7272,"length1":32,"length2":49},{"diffs":[[0,"weekend:false}, "],[1,"\n                "],[0,"{temperature:\"0\""]],"start1":7413,"start2":7413,"length1":32,"length2":49},{"diffs":[[0,"weekend:false}, "],[1,"\n                "],[0,"{temperature:\"0\""]],"start1":7554,"start2":7554,"length1":32,"length2":49},{"diffs":[[0,"end:false}, "],[1,"\n                "],[0,"{temperature"]],"start1":7699,"start2":7699,"length1":24,"length2":41},{"diffs":[[0,":true}, "],[1,"\n                "],[0,"{tempera"]],"start1":7843,"start2":7843,"length1":16,"length2":33},{"diffs":[[0,"nd:true}"],[1,"\n            "],[0,"]\n      "]],"start1":7981,"start2":7981,"length1":16,"length2":29}]],"length":46577,"saved":false}
{"ts":1357915542426,"patch":[[{"diffs":[[0,"s: ["],[-1,"\n                {temperature:\"5\", humidity:\"1\", day:11, date:\"January 11, 2013\", temperature_size:\"40px\", humidity_size:\"9px\", weekend:false}, \n                {temperature:\"0\", humidity:\"0\", day:10, date:\"January 10, 2013\", temperature_size:\"1px\", humidity_size:\"1px\", weekend:false}, \n                {temperature:\"0\", humidity:\"0\", day:9, date:\"January 9, 2013\", temperature_size:\"1px\", humidity_size:\"1px\", weekend:false}, \n                {temperature:\"0\", humidity:\"0\", day:8, date:\"January 8, 2013\", temperature_size:\"1px\", humidity_size:\"1px\", weekend:false}, \n                {temperature:\"0\", humidity:\"0\", day:7, date:\"January 7, 2013\", temperature_size:\"1px\", humidity_size:\"1px\", weekend:false}, \n                {temperature:\"0\", humidity:\"0\", day:6, date:\"January 6, 2013\", temperature_size:\"1px\", humidity_size:\"1px\", weekend:true}, \n                {temperature:\"0\", humidity:\"0\", day:5, date:\"January 5, 2013\", temperature_size:\"1px\", humidity_size:\"1px\", weekend:true}\n           "],[0," ]\n "]],"start1":6997,"start2":6997,"length1":1008,"length2":8}]],"length":45577,"saved":false}
{"ts":1357915563730,"patch":[[{"diffs":[[0,"_days: ["],[1,"'heeeelo'"],[0," ]\n     "]],"start1":6993,"start2":6993,"length1":16,"length2":25}]],"length":45586,"saved":false}
{"ts":1357915854712,"patch":[[{"diffs":[[0,"s: ["],[-1,"'heeeelo'"],[1," {}"],[0," ]\n "]],"start1":6997,"start2":6997,"length1":17,"length2":11}]],"length":45580,"saved":false}
{"ts":1357915896180,"patch":[[{"diffs":[[0,"ays: [ {"],[-1,"}"],[1,"xx: 'xxx'}, {xx: 'ppp'"],[0," ]\n     "]],"start1":6995,"start2":6995,"length1":17,"length2":38}]],"length":45601,"saved":false}
{"ts":1357915913196,"patch":[[{"diffs":[[0,"x: 'ppp'"],[1,"}"],[0," ]\n     "]],"start1":7017,"start2":7017,"length1":16,"length2":17}]],"length":45602,"saved":false}
{"ts":1357916098468,"patch":[[{"diffs":[[0," [ {"],[-1,"xx: 'xxx'}, {xx: 'ppp"],[1,"temperature_size: '25px'}, {temperature_size: '25px"],[0,"'} ]"]],"start1":6999,"start2":6999,"length1":29,"length2":59}]],"length":45632,"saved":false}
