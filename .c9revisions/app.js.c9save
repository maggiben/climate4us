{"ts":1355009267634,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\n/**\n * Module dependencies.\n */\n\nvar express = require('express'), \n    routes = require('./routes'),\n    conf = require('./config'),\n    cons = require('consolidate');\n//var mongo = require('mongoskin');\n\n//console.log(cons);\n\nvar app = express();\n\n// ## CORS middleware\n// see: http://stackoverflow.com/questions/7067966/how-to-allow-cors-in-express-nodejs\nvar allowCrossDomain = function(req, res, next) {\n    res.header('Access-Control-Allow-Origin', '*');\n    res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE');\n    res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n\n    // intercept OPTIONS method\n    if ('OPTIONS' == req.method) {\n      res.send(200);\n    }\n    else {\n      next();\n    }\n};\n\n// Configuration\napp.configure(function(){\n    app.engine('html', cons.mustache);\n    app.set('view engine', 'html');\n    app.set('views', __dirname + '/views');\n    app.use(express.bodyParser());\n    app.use(express.methodOverride());\n    app.use(allowCrossDomain);\n    app.use(express.cookieParser());\n    app.use(express.session({ secret: conf.sessionSecret }));\n    app.use(require('stylus').middleware({ src: __dirname + '/public' }));\n    app.use(app.router);\n    app.use(express.static(__dirname + '/public'));\n});\n\napp.configure('development', function(){\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));\n});\n\napp.configure('production', function(){\n  app.use(express.errorHandler());\n});\n\n// Routes\napp.all('/', function(req, res, next) {\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Headers\", \"X-Requested-With\");\n    next();\n});\n \n\napp.get('/', function(request, response) {\n    response.sendfile(__dirname + '/public/index.html');\n})\napp.get('/app', routes.index);\n\napp.post('/station', function(request, response){\n  console.log(request.body);      // your JSON\n  response.send(request.body);    // echo the result back\n});\n\napp.get('/setup', function(request, response) {\n    response.contentType('application/json');\n    \n    /*\n    var conn_db = mongo.db('admin:12345@alex.mongohq.com:10062/cloud-db');\n    var collection = conn_db.collection('ladies');\n    collection.insert({name: 'Hollywood Rose', members: ['Axl Rose', 'Izzy Stradlin', 'Chris Weber'], year: 1984}); \n    */\n    var user = {\n        \"user\":\n        {\n        \tname: \"MrX\",\n            last_name: null,\n    \t\tfirst_name: null,\n            email: \"benjaminmaggi@gmail.com\",\n            id: \"50bc04d3613f5d6105000002\",\n    \t\turls:\n    \t\t\t{\n    \t\t\t\t\"self\":\"https://secure.gaug.es/me\",\n    \t\t\t\t\"gauges\":\"https://secure.gaug.es/gauges\",\n    \t\t\t\t\"clients\":\"https://secure.gaug.es/clients\"\n    \t\t\t},\n    \t}\n    };\n    // Since the request is for a JSON representation of the people, we\n    //  should JSON serialize them. The built-in JSON.stringify() function\n    //  does that.\n    var userJSON = JSON.stringify(user);\n\n    // Now, we can use the response object's send method to push that string\n    //  of people JSON back to the browser in response to this request:\n    response.send(userJSON);\n});\n\napp.get('/start', function(request, response) {\n    // We want to set the content-type header so that the browser understands\n    //  the content of the response.\n    response.contentType('application/json');\n\n    // Normally, the would probably come from a database, but we can cheat:\n    var last_7_days = [\n    { views_size: '05px', people_size: '25px' },\n    { views_size: '10px', people_size: '20px' },\n    { views_size: '15px', people_size: '15px' },\n    { views_size: '20px', people_size: '10px' },\n    { views_size: '25px', people_size: '05px' },\n    { views_size: '20px', people_size: '00px' },\n    { views_size: '10px', people_size: '10px' },\n    ];\n    \n  // Since the request is for a JSON representation of the people, we\n  //  should JSON serialize them. The built-in JSON.stringify() function\n  //  does that.\n  var last_7_daysJSON = JSON.stringify(last_7_days);\n\n  // Now, we can use the response object's send method to push that string\n  //  of people JSON back to the browser in response to this request:\n  response.send(last_7_daysJSON);\n});\n\napp.get('/subscription', function(request, response) {\n    // We want to set the content-type header so that the browser understands\n    //  the content of the response.\n    response.contentType('application/json');\n\n    var user = {\n    \"user\":\n        {\n    \t\tname: \"MrX\",\n            last_name:null,\n    \t\tfirst_name:null,\n            email: \"benjaminmaggi@gmail.com\",\n            id: \"50bc04d3613f5d6105000002\",\n    \t\turls:\n    \t\t\t{\n    \t\t\t\t\"self\":\"https://secure.gaug.es/me\",\n    \t\t\t\t\"gauges\":\"https://secure.gaug.es/gauges\",\n    \t\t\t\t\"clients\":\"https://secure.gaug.es/clients\"\n    \t\t\t},\n    \t}\n    };\n    // Since the request is for a JSON representation of the people, we\n    //  should JSON serialize them. The built-in JSON.stringify() function\n    //  does that.\n    var userJSON = JSON.stringify(user);\n\n    // Now, we can use the response object's send method to push that string\n    //  of people JSON back to the browser in response to this request:\n    response.send(userJSON);\n});\napp.listen(conf.listenPort, function(){\n  console.log(\"Express server listening on port %d in %s mode\", process.env.PORT, app.settings.env);\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":5300}]],"length":5300}
{"contributors":[],"silentsave":true,"ts":1355009904521,"patch":[[{"diffs":[[0,");\n    \n"],[1,"    \n    \n    \n    \n    \n    \n"],[0,"    /*\n "]],"start1":2042,"start2":2042,"length1":16,"length2":46}]],"length":5330,"saved":false}
{"ts":1355009956222,"patch":[[{"diffs":[[0,"');\n"],[-1,"    \n    \n    \n    \n    \n    \n    \n"],[0,"    "]],"start1":2041,"start2":2041,"length1":43,"length2":8}]],"length":5295,"saved":false}
{"ts":1355011700139,"patch":[[{"diffs":[[0,"date');\n"],[1,"        mongoose = require('mongoose'),\n    passport = require('passport'),\n    LocalStrategy = require('passport-local').Strategy;\n"],[0,"//var mo"]],"start1":162,"start2":162,"length1":16,"length2":148}]],"length":5427,"saved":false}
{"ts":1355011702792,"patch":[[{"diffs":[[0,"gy;\n"],[-1,"//var mongo = require('mongoskin');"],[0,"\n\n//"]],"start1":298,"start2":298,"length1":43,"length2":8}]],"length":5392,"saved":false}
{"ts":1355011705465,"patch":[[{"diffs":[[0,"date');\n"],[-1,"    "],[0,"    mong"]],"start1":162,"start2":162,"length1":20,"length2":16}]],"length":5388,"saved":false}
{"ts":1355011737212,"patch":[[{"diffs":[[0,");\n});\n\n"],[1,"// Connect mongoose\nmongoose.connect('mongodb://admin:12345@alex.mongohq.com:10062/cloud-db');\n//var conn_db = mongo.db('admin:12345@alex.mongohq.com:10062/cloud-db');\nmongoose.connection.on(\"open\", function(){\n  console.log(\"mongodb is connected!!\");\n});\n\n"],[0,"// Route"]],"start1":1552,"start2":1552,"length1":16,"length2":273}]],"length":5645,"saved":false}
{"ts":1355011765288,"patch":[[{"diffs":[[0,"ler());\n});\n"],[1,"// Configure passport\nvar Account = require('./models/account');\n\npassport.use(new LocalStrategy(Account.authenticate()));\n\npassport.serializeUser(Account.serializeUser());\npassport.deserializeUser(Account.deserializeUser());"],[0,"\n// Connect "]],"start1":1547,"start2":1547,"length1":24,"length2":249}]],"length":5870,"saved":false}
{"ts":1355011768637,"patch":[[{"diffs":[[0,"));\n});\n"],[1,"\n"],[0,"// Confi"]],"start1":1551,"start2":1551,"length1":16,"length2":17}]],"length":5871,"saved":false}
{"ts":1355011846801,"patch":[[{"diffs":[[0,"(userJSON);\n});\n"],[-1,"\n"],[0,"app.get('/start'"]],"start1":3650,"start2":3650,"length1":33,"length2":32},{"diffs":[[0,"sJSON);\n});\n"],[-1,"\n"],[0,"app.get('/su"]],"start1":4716,"start2":4716,"length1":25,"length2":24}]],"length":5869,"saved":false}
{"ts":1355011847940,"patch":[[{"diffs":[[0,"lt back\n});\n"],[-1,"\n"],[0,"app.get('/se"]],"start1":2514,"start2":2514,"length1":25,"length2":24}]],"length":5868,"saved":false}
{"ts":1355011849129,"patch":[[{"diffs":[[0,"index);\n"],[-1,"\n"],[0,"app.post"]],"start1":2358,"start2":2358,"length1":17,"length2":16}]],"length":5867,"saved":false}
{"ts":1355011854249,"patch":[[{"diffs":[[0,"erJSON);\n});"],[1,"\n\n    app.post('/register', function(req, res) {\n        var username = req.body.username;\n        \n        Account.findOne({username : username }, function(err, existingUser) {\n            if (err || existingUser) {\n                return res.render('register', { account : account });\n            }\n\n            var account = new Account({ username : req.body.username });\n            account.setPassword(req.body.password, function(err) {\n                if (err) {\n                    return res.render('register', { account : account });\n                }\n\n                account.save(function(err) {\n                    if (err) {\n                        return res.render('register', { account : account });\n                    }\n\n                    res.redirect('/');\n                });\n            });\n        });\n    });"],[0,"\napp.listen("]],"start1":5709,"start2":5709,"length1":24,"length2":857}]],"length":6700,"saved":false}
{"ts":1355011858817,"patch":[[{"diffs":[[0,"N);\n});\n"],[-1,"\n    "],[0,"app.post"]],"start1":5714,"start2":5714,"length1":21,"length2":16}]],"length":6695,"saved":false}
{"ts":1355012341520,"patch":[[{"diffs":[[0,"rJSON);\n});\n"],[1,"app.get('/app', routes.index);\n"],[0,"app.post('/r"]],"start1":5710,"start2":5710,"length1":24,"length2":55}]],"length":6726,"saved":false}
{"ts":1355012344275,"patch":[[{"diffs":[[0,";\n});\napp.get('/"],[-1,"app"],[1,"register"],[0,"', routes.index)"]],"start1":5716,"start2":5716,"length1":35,"length2":40}]],"length":6731,"saved":false}
{"ts":1355012346753,"patch":[[{"diffs":[[0,"gister', routes."],[-1,"index"],[1,"register"],[0,");\napp.post('/re"]],"start1":5734,"start2":5734,"length1":37,"length2":40}]],"length":6734,"saved":false}
{"ts":1355012399405,"patch":[[{"diffs":[[0,"passport'),\n"],[1,"var passport = require('passport'),\n    Account = require('./models/account');\n"],[0,"    LocalStr"]],"start1":230,"start2":230,"length1":24,"length2":103}]],"length":6813,"saved":false}
{"ts":1355012405937,"patch":[[{"diffs":[[0,"'),\n"],[-1,"var passport = require('passport'),\n"],[0,"    "]],"start1":238,"start2":238,"length1":44,"length2":8}]],"length":6777,"saved":false}
{"ts":1355012739525,"patch":[[{"diffs":[[0," routes."],[-1,"register"],[1,"index"],[0,");\napp.p"]],"start1":5785,"start2":5785,"length1":24,"length2":21}]],"length":6774,"saved":false}
{"ts":1355012774906,"patch":[[{"diffs":[[0,"gister', routes."],[-1,"index"],[1,"register"],[0,");\napp.post('/re"]],"start1":5777,"start2":5777,"length1":37,"length2":40}]],"length":6777,"saved":false}
{"ts":1355012816428,"patch":[[{"diffs":[[0,"req, res) {\n"],[1,"    \n"],[0,"        var "]],"start1":5835,"start2":5835,"length1":24,"length2":29}]],"length":6782,"saved":false}
{"ts":1355012831536,"patch":[[{"diffs":[[0," res) {\n    "],[1,"    console.log(\"register \");"],[0,"\n        var"]],"start1":5839,"start2":5839,"length1":24,"length2":53}]],"length":6811,"saved":false}
{"ts":1355012832485,"patch":[[{"diffs":[[0,"egister "],[1,"POST"],[0,"\");\n    "]],"start1":5869,"start2":5869,"length1":16,"length2":20}]],"length":6815,"saved":false}
{"ts":1355013085273,"patch":[[{"diffs":[[0,"    "],[-1,"console.log(\"register POST\");"],[0,"\n   "]],"start1":5851,"start2":5851,"length1":37,"length2":8},{"diffs":[[0,"ername;\n        "],[1,"console.log(\"register POST\");"],[0,"\n        Account"]],"start1":5890,"start2":5890,"length1":32,"length2":61}]],"length":6815,"saved":false}
{"ts":1355013091835,"patch":[[{"diffs":[[0,"ster"],[-1," POST"],[0,"\");\n"]],"start1":5923,"start2":5923,"length1":13,"length2":8}]],"length":6810,"saved":false}
{"ts":1355013093662,"patch":[[{"diffs":[[0,"register"],[1,"ing: "],[0,"\");\n    "]],"start1":5919,"start2":5919,"length1":16,"length2":21}]],"length":6815,"saved":false}
{"ts":1355013094801,"patch":[[{"diffs":[[0,"tering: "],[1,"user"],[0,"\");\n    "]],"start1":5924,"start2":5924,"length1":16,"length2":20}]],"length":6819,"saved":false}
{"ts":1355013095882,"patch":[[{"diffs":[[0,"ng: user"],[1," %"],[0,"\");\n    "]],"start1":5928,"start2":5928,"length1":16,"length2":18}]],"length":6821,"saved":false}
{"ts":1355013097483,"patch":[[{"diffs":[[0,": user %"],[1,"s"],[0,"\");\n    "]],"start1":5930,"start2":5930,"length1":16,"length2":17}]],"length":6822,"saved":false}
{"ts":1355013112382,"patch":[[{"diffs":[[0,"user %s\""],[1,", user"],[0,");\n     "]],"start1":5932,"start2":5932,"length1":16,"length2":22}]],"length":6828,"saved":false}
{"ts":1355013114537,"patch":[[{"diffs":[[0,"s\", user"],[1,"name"],[0,");\n     "]],"start1":5938,"start2":5938,"length1":16,"length2":20}]],"length":6832,"saved":false}
{"ts":1355013116670,"patch":[[{"diffs":[[0,"ng: user"],[1,";"],[0," %s\", us"]],"start1":5928,"start2":5928,"length1":16,"length2":17}]],"length":6833,"saved":false}
{"ts":1355013119522,"patch":[[{"diffs":[[0,"user"],[-1,";"],[1,":"],[0," %s"],[1," p"],[0,"\", u"]],"start1":5932,"start2":5932,"length1":12,"length2":14}]],"length":6835,"saved":false}
{"ts":1355013121744,"patch":[[{"diffs":[[0,"er: %s p"],[1,"ass"],[0,"\", usern"]],"start1":5934,"start2":5934,"length1":16,"length2":19}]],"length":6838,"saved":false}
{"ts":1355013123444,"patch":[[{"diffs":[[0," %s pass"],[1,": %"],[0,"\", usern"]],"start1":5937,"start2":5937,"length1":16,"length2":19}]],"length":6841,"saved":false}
{"ts":1355013125031,"patch":[[{"diffs":[[0," pass: %"],[1,"s"],[0,"\", usern"]],"start1":5940,"start2":5940,"length1":16,"length2":17}]],"length":6842,"saved":false}
{"ts":1355013126292,"patch":[[{"diffs":[[0,"username"],[1,", "],[0,");\n     "]],"start1":5952,"start2":5952,"length1":16,"length2":18}]],"length":6844,"saved":false}
{"ts":1355013135659,"patch":[[{"diffs":[[0,"ername, "],[1,"req.body.password"],[0,");\n     "]],"start1":5954,"start2":5954,"length1":16,"length2":33}]],"length":6861,"saved":false}
{"ts":1355013181357,"patch":[[{"diffs":[[0,"sword);\n"],[1,"        \n"],[0,"        "]],"start1":5974,"start2":5974,"length1":16,"length2":25}]],"length":6870,"saved":false}
{"ts":1355013187423,"patch":[[{"diffs":[[0,"s: %s\", "],[1,"req.body."],[0,"username"]],"start1":5944,"start2":5944,"length1":16,"length2":25}]],"length":6879,"saved":false}
{"ts":1355013368558,"patch":[[{"diffs":[[0,"existingUser) {\n"],[1,"                \n"],[0,"                "]],"start1":6101,"start2":6101,"length1":32,"length2":49}]],"length":6896,"saved":false}
{"ts":1355013370518,"patch":[[{"diffs":[[0,"                "],[1,"console.log(\"registering: user"],[0,"\n               "]],"start1":6117,"start2":6117,"length1":32,"length2":62}]],"length":6926,"saved":false}
{"ts":1355013373514,"patch":[[{"diffs":[[0,"le.log(\""],[-1,"reg"],[1,"ex"],[0,"ist"],[-1,"er"],[0,"ing"],[-1,": u"],[1,"U"],[0,"ser"],[1,"\")"],[0,"\n       "]],"start1":6138,"start2":6138,"length1":33,"length2":30}]],"length":6923,"saved":false}
{"ts":1355013374919,"patch":[[{"diffs":[[0,"ngUser\")"],[1,";"],[0,"\n       "]],"start1":6152,"start2":6152,"length1":16,"length2":17}]],"length":6924,"saved":false}
{"ts":1355013459731,"patch":[[{"diffs":[[0,"              }\n"],[-1,"\n"],[0,"                "]],"start1":6667,"start2":6667,"length1":33,"length2":32}]],"length":6923,"saved":false}
{"ts":1355013463232,"patch":[[{"diffs":[[0,";\n            }\n"],[-1,"\n"],[0,"            var "]],"start1":6230,"start2":6230,"length1":33,"length2":32},{"diffs":[[0,"      }\n"],[-1,"\n"],[0,"        "]],"start1":6497,"start2":6497,"length1":17,"length2":16}]],"length":6921,"saved":false}
{"ts":1355013631411,"patch":[[{"diffs":[[0,"(userJSON);\n});\n"],[1,"// U\n"],[0,"app.get('/regist"]],"start1":5749,"start2":5749,"length1":32,"length2":37},{"diffs":[[0,"});\n    });\n"],[1,"    \n    \n    \n"],[0,"app.listen(c"]],"start1":6769,"start2":6769,"length1":24,"length2":39}]],"length":6941,"saved":false}
{"ts":1355013632681,"patch":[[{"diffs":[[0,"});\n// U"],[1,"ser "],[0,"\napp.get"]],"start1":5761,"start2":5761,"length1":16,"length2":20}]],"length":6945,"saved":false}
{"ts":1355013633911,"patch":[[{"diffs":[[0,"// User "],[1,"Log"],[0,"\napp.get"]],"start1":5765,"start2":5765,"length1":16,"length2":19}]],"length":6948,"saved":false}
{"ts":1355013637905,"patch":[[{"diffs":[[0,"ser "],[-1,"Log"],[1,"Register "],[0,"\napp"]],"start1":5769,"start2":5769,"length1":11,"length2":17}]],"length":6954,"saved":false}
{"ts":1355013640720,"patch":[[{"diffs":[[0,"egister "],[1,"+ Login "],[0,"\napp.get"]],"start1":5774,"start2":5774,"length1":16,"length2":24}]],"length":6962,"saved":false}
{"ts":1355013645953,"patch":[[{"diffs":[[0,"ser "],[-1,"Register + Login "],[1,"valida"],[0,"\napp"]],"start1":5769,"start2":5769,"length1":25,"length2":14}]],"length":6951,"saved":false}
{"ts":1355013648458,"patch":[[{"diffs":[[0,"r valida"],[1,"tion "],[0,"\napp.get"]],"start1":5771,"start2":5771,"length1":16,"length2":21}]],"length":6956,"saved":false}
{"ts":1355013651986,"patch":[[{"diffs":[[0,"});\n    });\n"],[1,"app.get('/login', function(req, res) {\n        res.render('login', { user : req.user });\n    });\n\n    app.post('/login', passport.authenticate('local'), function(req, res) {\n        res.redirect('/');\n    });\n\n    app.get('/logout', function(req, res) {\n        req.logout();\n        res.redirect('/');\n    });"],[0,"    \n    \n  "]],"start1":6784,"start2":6784,"length1":24,"length2":334}]],"length":7266,"saved":false}
{"ts":1355013663829,"patch":[[{"diffs":[[0,"eq.user });\n"],[-1,"    "],[0,"});\n\n    app"]],"start1":6873,"start2":6873,"length1":28,"length2":24}]],"length":7262,"saved":false}
{"ts":1355013666450,"patch":[[{"diffs":[[0,"er });\n});\n\n"],[-1,"    "],[0,"app.post('/l"]],"start1":6878,"start2":6878,"length1":28,"length2":24},{"diffs":[[0,"ion(req, res) {\n"],[-1,"    "],[0,"    res.redirect"]],"start1":6946,"start2":6946,"length1":36,"length2":32},{"diffs":[[0,"');\n"],[-1,"    "],[0,"});\n\n"],[-1,"    "],[0,"app."]],"start1":6981,"start2":6981,"length1":21,"length2":13},{"diffs":[[0,"req, res) {\n"],[-1,"    "],[0,"    req.logo"]],"start1":7018,"start2":7018,"length1":28,"length2":24},{"diffs":[[0,"gout();\n    "],[-1," "],[-1,"   "],[0,"res.redirect"]],"start1":7040,"start2":7040,"length1":28,"length2":24},{"diffs":[[0,"t('/');\n"],[-1,"    "],[0,"});    \n"]],"start1":7063,"start2":7063,"length1":20,"length2":16}]],"length":7234,"saved":false}
{"ts":1355013668509,"patch":[[{"diffs":[[0,"ser });\n});\n"],[-1,"\n"],[0,"app.post('/l"]],"start1":6877,"start2":6877,"length1":25,"length2":24}]],"length":7233,"saved":false}
{"ts":1355013718897,"patch":[[{"diffs":[[0,"});    \n"],[-1,"    "],[0,"\n    \nap"]],"start1":7070,"start2":7070,"length1":20,"length2":16}]],"length":7229,"saved":false}
{"ts":1355013722896,"patch":[[{"diffs":[[0,"/');\n});"],[-1,"    "],[0,"\n\n    \na"]],"start1":7065,"start2":7065,"length1":20,"length2":16}]],"length":7225,"saved":false}
{"ts":1355013724970,"patch":[[{"diffs":[[0,"t('/');\n});\n"],[-1,"\n"],[0,"app.get('/lo"]],"start1":6976,"start2":6976,"length1":25,"length2":24}]],"length":7224,"saved":false}
